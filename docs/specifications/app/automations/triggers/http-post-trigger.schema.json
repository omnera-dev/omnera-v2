{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "POST Request",
  "description": "Triggered by a POST request",
  "type": "object",
  "properties": {
    "service": {
      "type": "string",
      "const": "http",
      "x-business-rules": [
        "Fixed value (http) identifies this specific root.definitions.automation_trigger.anyOf.0.anyOf.0.properties.service type in discriminated unions and routing logic"
      ],
      "x-user-stories": [
        "GIVEN entity with service='http' WHEN processing configuration THEN correct handler should be selected",
        "GIVEN invalid service value WHEN validating configuration THEN clear error message should identify the issue"
      ]
    },
    "event": {
      "type": "string",
      "const": "post",
      "x-business-rules": [
        "Fixed value (post) identifies this specific root.definitions.automation_trigger.anyOf.0.anyOf.0.properties.event type in discriminated unions and routing logic"
      ],
      "x-user-stories": [
        "GIVEN entity with event='post' WHEN processing configuration THEN correct handler should be selected",
        "GIVEN invalid event value WHEN validating configuration THEN clear error message should identify the issue"
      ]
    },
    "params": {
      "type": "object",
      "properties": {
        "path": {
          "type": "string",
          "x-business-rules": [
            "Webhook path creates a unique HTTP endpoint for external services to trigger the automation",
            "Path should be descriptive and unique to prevent conflicts with other webhook endpoints",
            "Full webhook URL is generated by combining base domain with this path (e.g., https://app.omnera.io/webhooks/{path})"
          ],
          "x-user-stories": [
            "GIVEN user provides path WHEN validating input THEN string value should be accepted",
            "GIVEN path is empty string WHEN validating input THEN behavior should follow optional/required rules"
          ]
        },
        "respondImmediately": {
          "default": false,
          "type": "boolean",
          "x-business-rules": [
            "When true, HTTP 200 response is sent immediately before executing actions to prevent webhook timeouts",
            "When false (default), response is sent after all actions complete, allowing action results to be returned to caller",
            "Immediate response is recommended for long-running workflows to avoid timeout errors from external services"
          ],
          "x-user-stories": [
            "GIVEN respondImmediately is true WHEN processing entity THEN corresponding behavior should be enforced",
            "GIVEN respondImmediately is false (default: False) WHEN processing entity THEN corresponding behavior should not be enforced",
            "GIVEN configuration with respondImmediately WHEN validating settings THEN boolean value should be accepted"
          ]
        },
        "requestBody": {
          "$ref": "../automations.schema.json#/definitions/json_schema",
          "x-user-stories": [
            "GIVEN user configures requestBody WHEN validating input THEN value should meet schema requirements",
            "GIVEN requestBody is set WHEN processing configuration THEN value should be used correctly"
          ]
        }
      },
      "required": ["path"],
      "additionalProperties": false,
      "x-business-rules": [
        "Object structure groups related params properties for better organization and type-safe access"
      ],
      "x-user-stories": [
        "GIVEN user configures params WHEN validating input THEN value should meet schema requirements",
        "GIVEN params is set WHEN processing configuration THEN value should be used correctly"
      ]
    }
  },
  "required": ["service", "event", "params"],
  "additionalProperties": false,
  "x-user-stories": [
    "GIVEN a airtable record is created WHEN I trigger an automation THEN it should succeed",
    "GIVEN POST request sent WHEN I process actual lead data THEN it should succeed",
    "GIVEN the application is running WHEN I handle validation for HTTP trigger path as well THEN it should work correctly",
    "GIVEN the application is running WHEN I trigger an automation THEN it should work correctly",
    "GIVEN I am working with immediate response WHEN I trigger an automation THEN it should complete successfully",
    "GIVEN I am working with a invalid body WHEN I not trigger an automation THEN it should complete successfully",
    "GIVEN I am working with a valid object body WHEN I trigger an automation THEN it should complete successfully",
    "GIVEN I am working with a valid array body WHEN I trigger an automation THEN it should complete successfully",
    "GIVEN I am working with a valid array body and respond immediately WHEN I trigger an automation THEN it should complete successfully",
    "GIVEN I am working with form data WHEN I trigger an automation THEN it should complete successfully",
    "GIVEN I am working with a post request WHEN I not found the automation THEN it should complete successfully",
    "GIVEN a calendly invite is created WHEN I trigger an automation THEN it should succeed",
    "GIVEN POST request sent WHEN I process actual lead form data THEN it should succeed"
  ],
  "x-business-rules": [
    "Object structure groups related post request properties for better organization and type-safe access"
  ]
}
