{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Create Invoice",
  "description": "Creates a new invoice in Qonto",
  "type": "object",
  "properties": {
    "name": {
      "type": "string",
      "x-user-stories": [
        "GIVEN user provides name WHEN validating input THEN string value should be accepted",
        "GIVEN name is empty string WHEN validating input THEN behavior should follow optional/required rules"
      ]
    },
    "account": {
      "anyOf": [
        {
          "type": "number"
        },
        {
          "type": "string"
        }
      ],
      "x-user-stories": [
        "GIVEN user configures account WHEN validating input THEN value should meet schema requirements",
        "GIVEN account is set WHEN processing configuration THEN value should be used correctly"
      ]
    },
    "service": {
      "type": "string",
      "const": "qonto",
      "x-business-rules": [
        "Fixed value (qonto) identifies this specific root.definitions.automation_action.anyOf.4.anyOf.7.anyOf.1.properties.service type in discriminated unions and routing logic"
      ],
      "x-user-stories": [
        "GIVEN entity with service='qonto' WHEN processing configuration THEN correct handler should be selected",
        "GIVEN invalid service value WHEN validating configuration THEN clear error message should identify the issue"
      ]
    },
    "action": {
      "type": "string",
      "const": "create-invoice",
      "x-business-rules": [
        "Fixed value (create-invoice) identifies this specific root.definitions.automation_action.anyOf.4.anyOf.7.anyOf.1.properties.action type in discriminated unions and routing logic"
      ],
      "x-user-stories": [
        "GIVEN entity with action='create-invoice' WHEN processing configuration THEN correct handler should be selected",
        "GIVEN invalid action value WHEN validating configuration THEN clear error message should identify the issue"
      ]
    },
    "params": {
      "type": "object",
      "properties": {
        "client_id": {
          "description": "ID of the client for this invoice",
          "type": "string",
          "x-business-rules": ["ID of the client for this invoice"],
          "x-user-stories": [
            "GIVEN a user connects external service WHEN providing OAuth client ID THEN authentication should succeed with valid credentials",
            "GIVEN invalid OAuth client ID WHEN attempting authentication THEN system should return clear error message",
            "GIVEN automation needs external API access WHEN executing action THEN stored OAuth tokens should be used for authentication"
          ]
        },
        "amount": {
          "description": "Invoice total amount",
          "type": "number",
          "exclusiveMinimum": 0,
          "x-user-stories": [
            "GIVEN user provides amount WHEN validating input THEN numeric value should be accepted",
            "GIVEN user provides non-numeric amount WHEN validating input THEN error should require number"
          ]
        },
        "currency": {
          "description": "Invoice currency",
          "default": "EUR",
          "type": "string",
          "x-business-rules": [
            "Defaults to \"EUR\" when not specified, providing sensible fallback behavior without requiring explicit configuration"
          ],
          "x-user-stories": [
            "GIVEN user provides currency WHEN validating input THEN string value should be accepted",
            "GIVEN currency is empty string WHEN validating input THEN behavior should follow optional/required rules"
          ]
        },
        "due_date": {
          "description": "Invoice due date (ISO 8601 format)",
          "type": "string",
          "x-business-rules": ["Invoice due date (ISO 8601 format)"],
          "x-user-stories": [
            "GIVEN user provides due_date WHEN validating input THEN string value should be accepted",
            "GIVEN due_date is empty string WHEN validating input THEN behavior should follow optional/required rules"
          ]
        },
        "items": {
          "description": "Invoice line items",
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "description": {
                "description": "Item description",
                "type": "string",
                "x-user-stories": [
                  "GIVEN user provides description WHEN validating input THEN string value should be accepted",
                  "GIVEN description is empty string WHEN validating input THEN behavior should follow optional/required rules"
                ]
              },
              "quantity": {
                "description": "Quantity",
                "type": "number",
                "exclusiveMinimum": 0,
                "x-user-stories": [
                  "GIVEN user provides quantity WHEN validating input THEN numeric value should be accepted",
                  "GIVEN user provides non-numeric quantity WHEN validating input THEN error should require number"
                ]
              },
              "unit_price": {
                "description": "Unit price",
                "type": "number",
                "exclusiveMinimum": 0,
                "x-user-stories": [
                  "GIVEN user provides unit_price WHEN validating input THEN numeric value should be accepted",
                  "GIVEN user provides non-numeric unit_price WHEN validating input THEN error should require number"
                ]
              }
            },
            "required": ["description", "quantity", "unit_price"],
            "additionalProperties": false,
            "x-business-rules": [
              "Object structure groups related items properties for better organization and type-safe access"
            ]
          },
          "x-business-rules": [
            "Array enables multiple items to be configured, supporting flexible workflows and batch operations"
          ],
          "x-user-stories": [
            "GIVEN user provides items array WHEN validating input THEN items should be processed in order",
            "GIVEN items array is empty WHEN validating input THEN behavior should follow optional/required rules"
          ]
        },
        "reference": {
          "description": "Invoice reference number",
          "type": "string",
          "x-business-rules": ["Invoice reference number"],
          "x-user-stories": [
            "GIVEN user provides reference WHEN validating input THEN string value should be accepted",
            "GIVEN reference is empty string WHEN validating input THEN behavior should follow optional/required rules"
          ]
        },
        "notes": {
          "description": "Additional notes",
          "type": "string",
          "x-user-stories": [
            "GIVEN user provides notes WHEN validating input THEN string value should be accepted",
            "GIVEN notes is empty string WHEN validating input THEN behavior should follow optional/required rules"
          ]
        }
      },
      "required": ["client_id", "amount", "currency", "due_date", "items"],
      "additionalProperties": false,
      "x-business-rules": [
        "Object structure groups related params properties for better organization and type-safe access"
      ],
      "x-user-stories": [
        "GIVEN user configures params WHEN validating input THEN value should meet schema requirements",
        "GIVEN params is set WHEN processing configuration THEN value should be used correctly"
      ]
    }
  },
  "required": ["name", "account", "service", "action", "params"],
  "additionalProperties": false,
  "x-business-rules": [
    "Object structure groups related create invoice properties for better organization and type-safe access"
  ]
}
