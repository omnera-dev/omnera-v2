{
  "$id": "https://omnera.dev/specs/app.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Omnera Application Specification",
  "description": "Root specification that orchestrates all feature and infrastructure specifications. This schema defines the complete system specification including infrastructure (auth, server), application features (tables, pages, automations), and administrative capabilities. It serves as the single source of truth for what the application SHOULD BE (specification), to be compared against what it IS (implementation in schemas/0.0.1/app.schema.json).",
  "type": "object",
  "required": ["infrastructure", "app"],
  "properties": {
    "app": {
      "type": "object",
      "description": "Application-level metadata (name, version, description)",
      "required": ["name", "version", "description"],
      "properties": {
        "name": {
          "$ref": "app/name.schema.json",
          "description": "Application name following npm package naming conventions"
        },
        "version": {
          "$ref": "app/version.schema.json",
          "description": "Application version following Semantic Versioning (SemVer) 2.0.0"
        },
        "description": {
          "$ref": "app/description.schema.json",
          "description": "Single-line description of the application"
        }
      }
    },
    "infrastructure": {
      "type": "object",
      "description": "Core infrastructure components (authentication, server, database)",
      "required": ["auth", "server"],
      "properties": {
        "auth": {
          "$ref": "infrastructure/auth/auth.schema.json",
          "description": "Authentication system with Better Auth integration, database persistence, session management, and OpenAPI documentation"
        },
        "server": {
          "$ref": "infrastructure/server/server.schema.json",
          "description": "Hono server with health checks, CSS serving, homepage rendering, OpenAPI documentation, Scalar UI, and error handling"
        }
      }
    }
  },
  "examples": [
    {
      "app": {
        "name": "my-app",
        "version": "1.0.0",
        "description": "A simple application"
      },
      "infrastructure": {
        "auth": {
          "signUp": { "endpoint": "/api/auth/sign-up/email" },
          "signIn": { "endpoint": "/api/auth/sign-in/email" },
          "session": { "getEndpoint": "/api/auth/get-session" }
        },
        "server": {
          "health": { "endpoint": "/api/health" },
          "css": { "endpoint": "/assets/output.css" },
          "openapi": { "jsonEndpoint": "/api/openapi.json", "scalarEndpoint": "/api/scalar" }
        }
      }
    }
  ],
  "x-implementation-notes": [
    "This specification schema (specs/app.schema.json) defines WHAT the system should have",
    "The implementation schema (schemas/0.0.1/app.schema.json) shows WHAT the system currently has",
    "The diff between these two schemas generates the development roadmap",
    "Business rules and user stories are defined in individual feature schemas (auth.schema.json, server.schema.json, etc.)",
    "Tests are explicitly linked to business rules via x-linked-tests properties",
    "This approach enables specification-driven development with automated progress tracking"
  ]
}
