{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Create Invoice",
  "description": "Creates a new invoice in Qonto",
  "type": "object",
  "properties": {
    "name": {
      "type": "string"
    },
    "account": {
      "anyOf": [
        {
          "type": "number"
        },
        {
          "type": "string"
        }
      ]
    },
    "service": {
      "type": "string",
      "const": "qonto"
    },
    "action": {
      "type": "string",
      "const": "create-invoice"
    },
    "params": {
      "type": "object",
      "properties": {
        "client_id": {
          "description": "ID of the client for this invoice",
          "type": "string"
        },
        "amount": {
          "description": "Invoice total amount",
          "type": "number",
          "exclusiveMinimum": 0
        },
        "currency": {
          "description": "Invoice currency",
          "default": "EUR",
          "type": "string"
        },
        "due_date": {
          "description": "Invoice due date (ISO 8601 format)",
          "type": "string"
        },
        "items": {
          "description": "Invoice line items",
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "description": {
                "description": "Item description",
                "type": "string"
              },
              "quantity": {
                "description": "Quantity",
                "type": "number",
                "exclusiveMinimum": 0
              },
              "unit_price": {
                "description": "Unit price",
                "type": "number",
                "exclusiveMinimum": 0
              }
            },
            "required": ["description", "quantity", "unit_price"],
            "additionalProperties": false
          }
        },
        "reference": {
          "description": "Invoice reference number",
          "type": "string"
        },
        "notes": {
          "description": "Additional notes",
          "type": "string"
        }
      },
      "required": ["client_id", "amount", "currency", "due_date", "items"],
      "additionalProperties": false
    }
  },
  "required": ["name", "account", "service", "action", "params"],
  "additionalProperties": false,
  "$id": "qonto-create-invoice-action.schema.json",
  "x-specs": [
    {
      "id": "APP-QONTO-CREATE-INVOICE-001",
      "given": "user provides name",
      "when": "validating input",
      "then": "string value should be accepted"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-002",
      "given": "name is empty string",
      "when": "validating input",
      "then": "behavior should follow optional/required rules"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-003",
      "given": "user configures account",
      "when": "validating input",
      "then": "value should meet schema requirements"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-004",
      "given": "account is set",
      "when": "processing configuration",
      "then": "value should be used correctly"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-005",
      "given": "entity with service='qonto'",
      "when": "processing configuration",
      "then": "correct handler should be selected"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-006",
      "given": "invalid service value",
      "when": "validating configuration",
      "then": "clear error message should identify the issue"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-007",
      "given": "entity with action='create-invoice'",
      "when": "processing configuration",
      "then": "correct handler should be selected"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-008",
      "given": "invalid action value",
      "when": "validating configuration",
      "then": "clear error message should identify the issue"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-009",
      "given": "user configures params",
      "when": "validating input",
      "then": "value should meet schema requirements"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-010",
      "given": "params is set",
      "when": "processing configuration",
      "then": "value should be used correctly"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-011",
      "given": "a user connects external service",
      "when": "providing OAuth client ID",
      "then": "authentication should succeed with valid credentials"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-012",
      "given": "invalid OAuth client ID",
      "when": "attempting authentication",
      "then": "system should return clear error message"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-013",
      "given": "automation needs external API access",
      "when": "executing action",
      "then": "stored OAuth tokens should be used for authentication"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-014",
      "given": "user provides amount",
      "when": "validating input",
      "then": "numeric value should be accepted"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-015",
      "given": "user provides non-numeric amount",
      "when": "validating input",
      "then": "error should require number"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-016",
      "given": "user provides currency",
      "when": "validating input",
      "then": "string value should be accepted"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-017",
      "given": "currency is empty string",
      "when": "validating input",
      "then": "behavior should follow optional/required rules"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-018",
      "given": "user provides due_date",
      "when": "validating input",
      "then": "string value should be accepted"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-019",
      "given": "due_date is empty string",
      "when": "validating input",
      "then": "behavior should follow optional/required rules"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-020",
      "given": "user provides items array",
      "when": "validating input",
      "then": "items should be processed in order"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-021",
      "given": "items array is empty",
      "when": "validating input",
      "then": "behavior should follow optional/required rules"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-022",
      "given": "user provides description",
      "when": "validating input",
      "then": "string value should be accepted"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-023",
      "given": "description is empty string",
      "when": "validating input",
      "then": "behavior should follow optional/required rules"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-024",
      "given": "user provides quantity",
      "when": "validating input",
      "then": "numeric value should be accepted"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-025",
      "given": "user provides non-numeric quantity",
      "when": "validating input",
      "then": "error should require number"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-026",
      "given": "user provides unit_price",
      "when": "validating input",
      "then": "numeric value should be accepted"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-027",
      "given": "user provides non-numeric unit_price",
      "when": "validating input",
      "then": "error should require number"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-028",
      "given": "user provides reference",
      "when": "validating input",
      "then": "string value should be accepted"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-029",
      "given": "reference is empty string",
      "when": "validating input",
      "then": "behavior should follow optional/required rules"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-030",
      "given": "user provides notes",
      "when": "validating input",
      "then": "string value should be accepted"
    },
    {
      "id": "APP-QONTO-CREATE-INVOICE-031",
      "given": "notes is empty string",
      "when": "validating input",
      "then": "behavior should follow optional/required rules"
    }
  ]
}
