{
  "$id": "rollup-field.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Rollup Field",
  "type": "object",
  "properties": {
    "id": {
      "$ref": "../../../common/definitions.schema.json#/definitions/id"
    },
    "name": {
      "$ref": "../../../common/definitions.schema.json#/definitions/name"
    },
    "type": {
      "type": "string",
      "const": "rollup"
    },
    "relationshipField": {
      "$ref": "./relationshipField/relationshipField.schema.json"
    },
    "relatedField": {
      "$ref": "./relatedField/relatedField.schema.json"
    },
    "aggregation": {
      "$ref": "./aggregation/aggregation.schema.json"
    },
    "format": {
      "$ref": "./format/format.schema.json"
    }
  },
  "description": "Aggregate values from related records through a relationship field. Reference a relationshipField in the current table and a relatedField in the linked table. Apply aggregation functions: sum (add all values), count (count records), average (mean value), min (smallest value), max (largest value), median (middle value), concat (join text values), unique (count distinct values). Optionally set display format for the result. Read-only field that automatically updates when related data changes. Useful for totals, counts, statistics from child records.",
  "required": ["id", "name", "type", "relationshipField", "relatedField", "aggregation"],
  "additionalProperties": false,
  "specs": [
    {
      "id": "APP-ROLLUP-FIELD-001",
      "given": "entity with type='rollup'",
      "when": "processing configuration",
      "then": "correct handler should be selected"
    },
    {
      "id": "APP-ROLLUP-FIELD-002",
      "given": "invalid type value",
      "when": "validating configuration",
      "then": "clear error message should identify the issue"
    }
  ]
}
