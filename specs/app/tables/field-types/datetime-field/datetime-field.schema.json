{
  "$id": "datetime-field.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "DateTime Field",
  "type": "object",
  "properties": {
    "id": {
      "$ref": "../../../common/definitions.schema.json#/definitions/id"
    },
    "name": {
      "$ref": "../../../common/definitions.schema.json#/definitions/name"
    },
    "required": {
      "$ref": "../common/required/required.schema.json"
    },
    "unique": {
      "$ref": "../common/unique/unique.schema.json"
    },
    "indexed": {
      "$ref": "../common/indexed/indexed.schema.json"
    },
    "type": {
      "type": "string",
      "const": "datetime",
      "description": "Field type discriminator for datetime fields with both date and time components",
      "examples": ["datetime"]
    },
    "format": {
      "$ref": "./format/format.schema.json"
    },
    "timezone": {
      "$ref": "./timezone/timezone.schema.json"
    },
    "default": {
      "$ref": "./default/default.schema.json"
    }
  },
  "description": "DateTime field for precise timestamps with both date and time components. Stores values in ISO 8601 datetime format (YYYY-MM-DDTHH:mm:ss.sssZ). Supports custom display formats, timezone specification (UTC, America/New_York, Europe/London), and optional default values. Useful for tracking events, audit logs, scheduling, and any temporal data requiring time precision.",
  "examples": [
    {
      "id": "fld_003",
      "name": "created_at",
      "type": "datetime",
      "required": true,
      "timezone": "UTC",
      "default": "now"
    },
    {
      "id": "fld_004",
      "name": "meeting_scheduled_at",
      "type": "datetime",
      "required": false,
      "indexed": true,
      "timezone": "America/New_York",
      "format": "MM/DD/YYYY hh:mm A"
    }
  ],
  "required": ["id", "name", "type"],
  "additionalProperties": false,
  "specs": [
    {
      "id": "APP-FIELD-DATETIME-001",
      "title": "Create record with valid datetime field",
      "given": "a table with a datetime field",
      "when": "user creates a record with a valid datetime value (ISO 8601)",
      "then": "the record is created successfully with the datetime stored in UTC"
    },
    {
      "id": "APP-FIELD-DATETIME-002",
      "title": "Reject invalid datetime format",
      "given": "a table with a datetime field",
      "when": "user provides a datetime in invalid format (e.g., '2024-12-31 10:30:00')",
      "then": "validation error is returned with message 'DateTime must be in ISO 8601 format (YYYY-MM-DDTHH:mm:ss.sssZ)'"
    },
    {
      "id": "APP-FIELD-DATETIME-003",
      "title": "Display datetime in user timezone",
      "given": "a datetime field with timezone 'America/New_York'",
      "when": "user views a record with datetime '2024-12-31T15:00:00.000Z'",
      "then": "the datetime is displayed as '12/31/2024 10:00 AM' (EST conversion)"
    },
    {
      "id": "APP-FIELD-DATETIME-004",
      "title": "Apply default value 'now' on record creation",
      "given": "a datetime field with default value 'now'",
      "when": "user creates a record without providing a datetime value",
      "then": "the field is populated with the current UTC timestamp in ISO 8601 format"
    },
    {
      "id": "APP-FIELD-DATETIME-005",
      "title": "Enforce required validation",
      "given": "a required datetime field",
      "when": "user attempts to create a record without providing a datetime value",
      "then": "validation error is returned with message 'DateTime is required'"
    },
    {
      "id": "APP-FIELD-DATETIME-006",
      "title": "Handle DST transitions correctly",
      "given": "a datetime field with timezone 'America/New_York'",
      "when": "user views datetimes across DST boundary (March/November)",
      "then": "the datetime is displayed with correct offset (EDT vs EST)"
    },
    {
      "id": "APP-FIELD-DATETIME-007",
      "title": "Support millisecond precision",
      "given": "a table with a datetime field",
      "when": "user creates a record with datetime '2024-12-31T15:00:00.123Z'",
      "then": "the milliseconds (.123) are preserved in storage and retrieval"
    }
  ]
}
