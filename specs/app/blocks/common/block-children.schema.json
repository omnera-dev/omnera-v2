{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "block-children.schema.json",
  "title": "Block Children",
  "description": "Child elements array for block templates",
  "type": "array",
  "items": {
    "type": "object",
    "properties": {
      "type": {
        "type": "string",
        "description": "Component type"
      },
      "props": {
        "$ref": "./block-props.schema.json"
      },
      "children": {
        "$ref": "#"
      },
      "content": {
        "type": "string",
        "description": "Text content (may contain $variable)"
      }
    },
    "required": ["type"],
    "additionalProperties": false
  },
  "examples": [
    [
      {
        "type": "icon",
        "props": {
          "name": "$icon",
          "color": "$color"
        }
      },
      {
        "type": "text",
        "content": "$label"
      }
    ]
  ],
  "x-specs": [
    {
      "id": "APP-BLOCKS-CHILDREN-001",
      "given": "children array for block templates",
      "when": "array contains child component objects",
      "then": "it should render nested component structure in DOM",
      "application": {
        "blocks": [
          {
            "name": "card",
            "type": "div",
            "children": [
              {
                "type": "div",
                "props": {
                  "className": "header"
                }
              },
              {
                "type": "div",
                "props": {
                  "className": "body"
                }
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Demo",
            "path": "/demo",
            "sections": [
              {
                "block": "card",
                "vars": {}
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-card\"><div class=\"header\"></div><div class=\"body\"></div></div>",
        "assertions": [
          "children array: Nested component structure",
          "Parent: <div data-testid=\"block-card\">",
          "Child 1: <div class=\"header\">",
          "Child 2: <div class=\"body\">",
          "Children order preserved in DOM (header first, body second)",
          "Each child object → DOM element"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-CHILDREN-002",
      "given": "child with required type",
      "when": "each child has type property",
      "then": "it should render child element based on type",
      "application": {
        "blocks": [
          {
            "name": "multi-type",
            "type": "div",
            "children": [
              {
                "type": "div"
              },
              {
                "type": "span"
              },
              {
                "type": "button"
              },
              {
                "type": "text"
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Types",
            "path": "/types",
            "sections": [
              {
                "block": "multi-type",
                "vars": {}
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-multi-type\"><div></div><span></span><button></button><span></span></div>",
        "assertions": [
          "type property: REQUIRED for every child",
          "type='div' → <div> element",
          "type='span' → <span> element",
          "type='button' → <button> element",
          "type='text' → <span> element (text wrapper)",
          "Each child's type determines HTML element rendered"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-CHILDREN-003",
      "given": "child with props",
      "when": "child has props referencing block-props.schema.json",
      "then": "it should render child with specified properties and attributes",
      "application": {
        "blocks": [
          {
            "name": "header-card",
            "type": "div",
            "children": [
              {
                "type": "div",
                "props": {
                  "className": "card-header",
                  "id": "header-1",
                  "ariaLabel": "Card header"
                }
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Demo",
            "path": "/demo",
            "sections": [
              {
                "block": "header-card",
                "vars": {}
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-header-card\"><div class=\"card-header\" id=\"header-1\" aria-label=\"Card header\"></div></div>",
        "assertions": [
          "Child props: References block-props.schema.json",
          "className='card-header' → class attribute",
          "id='header-1' → id attribute",
          "ariaLabel='Card header' → aria-label attribute",
          "Props object defines child element attributes",
          "All props apply to rendered child element"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-CHILDREN-004",
      "given": "child with recursive children",
      "when": "child has children property with self-reference (#)",
      "then": "it should render unlimited nesting depth in DOM tree",
      "application": {
        "blocks": [
          {
            "name": "nested-list",
            "type": "ul",
            "children": [
              {
                "type": "li",
                "content": "Level 1",
                "children": [
                  {
                    "type": "ul",
                    "children": [
                      {
                        "type": "li",
                        "content": "Level 2",
                        "children": [
                          {
                            "type": "ul",
                            "children": [
                              {
                                "type": "li",
                                "content": "Level 3"
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Navigation",
            "path": "/nav",
            "sections": [
              {
                "block": "nested-list",
                "vars": {}
              }
            ]
          }
        ],
        "expectedDOM": "<ul data-testid=\"block-nested-list\"><li>Level 1<ul><li>Level 2<ul><li>Level 3</li></ul></li></ul></li></ul>",
        "assertions": [
          "Recursive children: Self-reference (#) enables unlimited nesting",
          "Nesting depth: 3 levels (ul → li → ul → li → ul → li)",
          "Each child can have its own children array",
          "Level 1 li has children (nested ul)",
          "Level 2 li has children (nested ul)",
          "Level 3 li has no children (leaf node)",
          "No limit on nesting depth - schema allows infinite recursion"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-CHILDREN-005",
      "given": "child with content",
      "when": "child has content string with $variable support",
      "then": "it should render child with substituted text content",
      "application": {
        "blocks": [
          {
            "name": "labeled-input",
            "type": "div",
            "children": [
              {
                "type": "text",
                "props": {
                  "level": "label"
                },
                "content": "$label"
              },
              {
                "type": "input",
                "props": {
                  "placeholder": "$placeholder"
                }
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Form",
            "path": "/form",
            "sections": [
              {
                "block": "labeled-input",
                "vars": {
                  "label": "Email Address",
                  "placeholder": "Enter your email"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-labeled-input\"><label>Email Address</label><input placeholder=\"Enter your email\" /></div>",
        "assertions": [
          "content property: Text content for child elements",
          "Child 1: type='text', level='label', content='$label' → <label>Email Address</label>",
          "Child 2: type='input', placeholder='$placeholder' → placeholder='Enter your email'",
          "content supports $variable substitution",
          "Content renders as inner text of element"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-CHILDREN-006",
      "given": "children for component composition",
      "when": "multiple children create complex structure",
      "then": "it should render composite UI pattern with all child elements",
      "application": {
        "blocks": [
          {
            "name": "pricing-card",
            "type": "card",
            "children": [
              {
                "type": "div",
                "props": {
                  "className": "card-header"
                },
                "children": [
                  {
                    "type": "text",
                    "props": {
                      "level": "h3"
                    },
                    "content": "$plan"
                  },
                  {
                    "type": "text",
                    "props": {
                      "level": "p"
                    },
                    "content": "$price"
                  }
                ]
              },
              {
                "type": "ul",
                "props": {
                  "className": "features"
                },
                "children": [
                  {
                    "type": "li",
                    "content": "$feature1"
                  },
                  {
                    "type": "li",
                    "content": "$feature2"
                  }
                ]
              },
              {
                "type": "button",
                "content": "$cta"
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Pricing",
            "path": "/pricing",
            "sections": [
              {
                "block": "pricing-card",
                "vars": {
                  "plan": "Pro",
                  "price": "$49/mo",
                  "feature1": "Unlimited users",
                  "feature2": "24/7 support",
                  "cta": "Get Started"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-pricing-card\" class=\"card\"><div class=\"card-header\"><h3>Pro</h3><p>$49/mo</p></div><ul class=\"features\"><li>Unlimited users</li><li>24/7 support</li></ul><button>Get Started</button></div>",
        "assertions": [
          "Component composition: Multiple children create complex structure",
          "Level 1: 3 top-level children (header div, features ul, button)",
          "Level 2: Header has 2 children (h3, p), Features has 2 children (2 li)",
          "All 5 variables substituted: plan, price, feature1, feature2, cta",
          "Real-world pricing card pattern with header, features list, CTA button"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-CHILDREN-007",
      "given": "icon child example",
      "when": "child has type 'icon' with props containing $icon and $color variables",
      "then": "it should render SVG icon with substituted name and color",
      "application": {
        "blocks": [
          {
            "name": "badge-with-icon",
            "type": "div",
            "children": [
              {
                "type": "icon",
                "props": {
                  "name": "$icon",
                  "color": "$color"
                }
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Status",
            "path": "/status",
            "sections": [
              {
                "block": "badge-with-icon",
                "vars": {
                  "icon": "check-circle",
                  "color": "green"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-badge-with-icon\"><svg data-testid=\"icon-check-circle\" data-color=\"green\"></svg></div>",
        "assertions": [
          "Icon child: type='icon' renders as <svg> element",
          "name prop: '$icon' → 'check-circle' → data-testid='icon-check-circle'",
          "color prop: '$color' → 'green' → data-color='green'",
          "Icon children enable SVG graphics in blocks"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-CHILDREN-008",
      "given": "text child example",
      "when": "child has type 'text' with content containing $label variable",
      "then": "it should render text element with substituted content",
      "application": {
        "blocks": [
          {
            "name": "simple-message",
            "type": "div",
            "children": [
              {
                "type": "text",
                "content": "$label"
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Dashboard",
            "path": "/dashboard",
            "sections": [
              {
                "block": "simple-message",
                "vars": {
                  "label": "Welcome back!"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-simple-message\"><span>Welcome back!</span></div>",
        "assertions": [
          "Text child: type='text' renders as <span> element",
          "content='$label' → 'Welcome back!' (variable substitution)",
          "Text children enable dynamic text content in blocks"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-CHILDREN-009",
      "given": "children with variable references",
      "when": "children contain $variable placeholders in props and content",
      "then": "it should render all children with substituted values throughout tree",
      "application": {
        "blocks": [
          {
            "name": "alert-card",
            "type": "div",
            "props": {
              "className": "alert-$variant"
            },
            "children": [
              {
                "type": "icon",
                "props": {
                  "name": "$icon",
                  "className": "text-$iconColor"
                }
              },
              {
                "type": "div",
                "children": [
                  {
                    "type": "text",
                    "props": {
                      "level": "h4"
                    },
                    "content": "$title"
                  },
                  {
                    "type": "text",
                    "content": "$message"
                  }
                ]
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Alerts",
            "path": "/alerts",
            "sections": [
              {
                "block": "alert-card",
                "vars": {
                  "variant": "success",
                  "icon": "check",
                  "iconColor": "green",
                  "title": "Success!",
                  "message": "Operation completed"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-alert-card\" class=\"alert-success\"><svg data-testid=\"icon-check\" class=\"text-green\"></svg><div><h4>Success!</h4><span>Operation completed</span></div></div>",
        "assertions": [
          "Variable substitution throughout nested children",
          "Parent: $variant → 'success' in className='alert-success'",
          "Icon child: $icon → 'check', $iconColor → 'green' in className='text-green'",
          "Nested text 1: $title → 'Success!' in h4",
          "Nested text 2: $message → 'Operation completed' in span",
          "All 5 variables substituted across 3 nesting levels"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-CHILDREN-010",
      "given": "children for UI tree structure",
      "when": "children array defines parent-child relationships",
      "then": "it should render hierarchical DOM tree with proper nesting",
      "application": {
        "blocks": [
          {
            "name": "page-section",
            "type": "section",
            "children": [
              {
                "type": "div",
                "props": {
                  "className": "container"
                },
                "children": [
                  {
                    "type": "div",
                    "props": {
                      "className": "row"
                    },
                    "children": [
                      {
                        "type": "div",
                        "props": {
                          "className": "col"
                        },
                        "content": "$content"
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Home",
            "path": "/",
            "sections": [
              {
                "block": "page-section",
                "vars": {
                  "content": "Content here"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<section data-testid=\"block-page-section\"><div class=\"container\"><div class=\"row\"><div class=\"col\">Content here</div></div></div></section>",
        "assertions": [
          "UI tree structure: Hierarchical parent-child relationships",
          "Tree depth: 4 levels (section → container div → row div → col div)",
          "Level 1: section (root)",
          "Level 2: div.container (child of section)",
          "Level 3: div.row (child of container)",
          "Level 4: div.col with text content (child of row)",
          "Bootstrap-like grid system: container → row → col pattern",
          "Children array enables complex nested structures"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-BLOCK-CHILDREN-REGRESSION-001",
      "given": "complete application configuration with all features",
      "when": "user completes full workflow",
      "then": "user can complete full children workflow",
      "workflow": [
        {
          "step": 1,
          "action": "User defines block template with children array containing nested component structure",
          "validation": "Children array validates with child objects having type (required), props, children (recursive), and content properties",
          "expectedState": "Block template 'product-card' created with 3 top-level children: header div, body div, footer div"
        },
        {
          "step": 2,
          "action": "User nests children within children to create hierarchical component tree",
          "validation": "Recursive children schema allows unlimited nesting depth via self-reference (#)",
          "expectedState": "Header div contains 2 children (h3 + p), body div contains icon + text list, footer contains button"
        },
        {
          "step": 3,
          "action": "User adds $variable placeholders in child props and content for dynamic data",
          "validation": "Child props and content support $variable syntax for substitution from block reference vars",
          "expectedState": "All text content, images, and attributes use $variables: $title, $price, $description, $icon, $features"
        },
        {
          "step": 4,
          "action": "System renders nested children as hierarchical DOM tree with proper parent-child relationships",
          "validation": "Children array order preserved in DOM, nesting depth maintained, each child's type determines HTML element",
          "expectedState": "DOM tree rendered: card → (header → h3 + p) + (body → icon + ul → li × 3) + (footer → button)"
        },
        {
          "step": 5,
          "action": "System substitutes all $variables throughout nested children tree",
          "validation": "Variable substitution works at all nesting levels, from root to deepest leaf nodes",
          "expectedState": "All $variables replaced across entire component hierarchy with values from block reference vars"
        }
      ],
      "application": {
        "completeExample": {
          "blocks": [
            {
              "name": "product-card",
              "type": "card",
              "props": {
                "className": "product-card border rounded-lg shadow-md p-6 max-w-sm"
              },
              "children": [
                {
                  "type": "div",
                  "props": {
                    "className": "card-header mb-4 pb-4 border-b"
                  },
                  "children": [
                    {
                      "type": "text",
                      "props": {
                        "level": "h3",
                        "className": "text-2xl font-bold text-gray-900"
                      },
                      "content": "$productName"
                    },
                    {
                      "type": "text",
                      "props": {
                        "level": "p",
                        "className": "text-xl text-blue-600 font-semibold mt-2"
                      },
                      "content": "$price"
                    }
                  ]
                },
                {
                  "type": "div",
                  "props": {
                    "className": "card-body mb-4"
                  },
                  "children": [
                    {
                      "type": "icon",
                      "props": {
                        "name": "$icon",
                        "color": "$iconColor",
                        "size": 8,
                        "className": "mb-3"
                      }
                    },
                    {
                      "type": "text",
                      "props": {
                        "level": "p",
                        "className": "text-gray-700 mb-4"
                      },
                      "content": "$description"
                    },
                    {
                      "type": "ul",
                      "props": {
                        "className": "space-y-2"
                      },
                      "children": [
                        {
                          "type": "li",
                          "props": {
                            "className": "flex items-center text-gray-600"
                          },
                          "children": [
                            {
                              "type": "icon",
                              "props": {
                                "name": "check",
                                "color": "green",
                                "size": 4,
                                "className": "mr-2"
                              }
                            },
                            {
                              "type": "text",
                              "content": "$feature1"
                            }
                          ]
                        },
                        {
                          "type": "li",
                          "props": {
                            "className": "flex items-center text-gray-600"
                          },
                          "children": [
                            {
                              "type": "icon",
                              "props": {
                                "name": "check",
                                "color": "green",
                                "size": 4,
                                "className": "mr-2"
                              }
                            },
                            {
                              "type": "text",
                              "content": "$feature2"
                            }
                          ]
                        },
                        {
                          "type": "li",
                          "props": {
                            "className": "flex items-center text-gray-600"
                          },
                          "children": [
                            {
                              "type": "icon",
                              "props": {
                                "name": "check",
                                "color": "green",
                                "size": 4,
                                "className": "mr-2"
                              }
                            },
                            {
                              "type": "text",
                              "content": "$feature3"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "div",
                  "props": {
                    "className": "card-footer"
                  },
                  "children": [
                    {
                      "type": "button",
                      "props": {
                        "className": "w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition",
                        "ariaLabel": "$ctaLabel"
                      },
                      "content": "$ctaText"
                    }
                  ]
                }
              ]
            }
          ],
          "pages": [
            {
              "name": "Products",
              "path": "/products",
              "sections": [
                {
                  "block": "product-card",
                  "vars": {
                    "productName": "Premium Plan",
                    "price": "$99/month",
                    "icon": "star",
                    "iconColor": "yellow",
                    "description": "Everything you need to grow your business",
                    "feature1": "Unlimited projects",
                    "feature2": "Advanced analytics",
                    "feature3": "Priority support",
                    "ctaLabel": "Subscribe to Premium Plan",
                    "ctaText": "Get Started"
                  }
                }
              ]
            }
          ]
        },
        "expectedDOM": "<div data-testid=\"block-product-card\" class=\"product-card border rounded-lg shadow-md p-6 max-w-sm\">\n  <div class=\"card-header mb-4 pb-4 border-b\">\n    <h3 class=\"text-2xl font-bold text-gray-900\">Premium Plan</h3>\n    <p class=\"text-xl text-blue-600 font-semibold mt-2\">$99/month</p>\n  </div>\n  <div class=\"card-body mb-4\">\n    <svg data-testid=\"icon-star\" data-color=\"yellow\" data-size=\"8\" class=\"mb-3\"></svg>\n    <p class=\"text-gray-700 mb-4\">Everything you need to grow your business</p>\n    <ul class=\"space-y-2\">\n      <li class=\"flex items-center text-gray-600\">\n        <svg data-testid=\"icon-check\" data-color=\"green\" data-size=\"4\" class=\"mr-2\"></svg>\n        <span>Unlimited projects</span>\n      </li>\n      <li class=\"flex items-center text-gray-600\">\n        <svg data-testid=\"icon-check\" data-color=\"green\" data-size=\"4\" class=\"mr-2\"></svg>\n        <span>Advanced analytics</span>\n      </li>\n      <li class=\"flex items-center text-gray-600\">\n        <svg data-testid=\"icon-check\" data-color=\"green\" data-size=\"4\" class=\"mr-2\"></svg>\n        <span>Priority support</span>\n      </li>\n    </ul>\n  </div>\n  <div class=\"card-footer\">\n    <button class=\"w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition\" aria-label=\"Subscribe to Premium Plan\">Get Started</button>\n  </div>\n</div>",
        "assertions": [
          "Children array: Nested component structure definition via array of child objects",
          "Hierarchical composition: Card with 3 sections (header, body, footer), each with nested children",
          "Nesting depth: 4 levels deep (card → body → ul → li → icon + text)",
          "Recursive children: Self-reference (#) enables unlimited nesting via children property",
          "Type property: REQUIRED for every child, determines HTML element (div, text → span, button, ul, li, icon → svg)",
          "Props integration: Child props follow block-props.schema.json (className, ariaLabel, etc.)",
          "Content property: Text content with $variable support for dynamic text",
          "Variable substitution: All $variables replaced at all nesting levels ($productName, $price, $feature1, etc.)",
          "Order preservation: Children array order maintained in rendered DOM (header → body → footer)",
          "Component composition: Complex UI patterns built from simple nested components",
          "Icon children: type='icon' renders SVG elements with name, color, size props",
          "Text children: type='text' renders span elements with text content",
          "List patterns: ul → li structures for feature lists with check icons",
          "Real-world pattern: Product card with header (title + price), body (icon + description + features), footer (CTA button)",
          "Single source of truth: Nested structure defined once in template, reused with different data via vars"
        ]
      },
      "integrationPoints": [
        "Props schema: Child props follow block-props.schema.json for flexible attribute definitions",
        "Variable substitution: Child content and props use $variable syntax resolved from block reference vars",
        "Recursive schema: children property references self (#) for unlimited nesting depth",
        "Type system: Child type determines rendered HTML element (div, span, button, ul, li, svg)",
        "Parent-child relationships: children array defines hierarchical DOM tree structure",
        "Block composition: Children enable complex component patterns via nesting",
        "Content property: Separate from children, holds text content with $variable support",
        "Tailwind CSS: className props support full Tailwind utility class system for styling",
        "Accessibility: Child props include ARIA attributes (ariaLabel, ariaDescribedBy, role)",
        "Icon system: Icon children integrate with icon library via name, color, size props",
        "List structures: Support for semantic HTML lists (ul, ol, li) with proper nesting",
        "Component library: Children patterns enable design system components (cards, alerts, modals)"
      ]
    }
  ]
}
