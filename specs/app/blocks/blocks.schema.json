{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "blocks.schema.json",
  "title": "Reusable Blocks",
  "description": "Array of reusable UI component templates with variable substitution for use across pages",
  "type": "array",
  "items": {
    "$ref": "./block/block.schema.json"
  },
  "examples": [
    [
      {
        "name": "icon-badge",
        "type": "badge",
        "props": {
          "color": "$color"
        },
        "children": [
          {
            "type": "icon",
            "props": {
              "name": "$icon",
              "size": 4
            }
          },
          {
            "type": "text",
            "props": {
              "level": "span"
            },
            "content": "$text"
          }
        ]
      },
      {
        "name": "section-header",
        "type": "container",
        "props": {
          "className": "text-center mb-12"
        },
        "children": [
          {
            "type": "text",
            "props": {
              "level": "h2",
              "className": "text-$titleColor text-4xl mb-4"
            },
            "content": "$title"
          },
          {
            "type": "text",
            "props": {
              "level": "p"
            },
            "content": "$subtitle"
          }
        ]
      }
    ]
  ],
  "x-specs": [
    {
      "id": "APP-BLOCKS-001",
      "given": "reusable blocks array",
      "when": "array contains block items referencing block.schema.json",
      "then": "it should validate blocks array structure at build time",
      "validation": {
        "setup": {
          "blocks": [
            {
              "name": "icon-badge",
              "type": "badge"
            },
            {
              "name": "section-header",
              "type": "container"
            }
          ]
        },
        "assertions": [
          "Blocks array validates against JSON Schema",
          "Each block item references block.schema.json",
          "Array can contain 0+ block definitions"
        ]
      },
      "application": {
        "blocks": [
          {
            "name": "icon-badge",
            "type": "badge",
            "props": {
              "className": "badge-$color"
            },
            "content": "$label"
          },
          {
            "name": "section-header",
            "type": "container",
            "props": {
              "className": "text-center mb-8"
            },
            "children": [
              {
                "type": "text",
                "props": {
                  "level": "h2"
                },
                "content": "$title"
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Home",
            "path": "/",
            "sections": [
              {
                "block": "section-header",
                "vars": {
                  "title": "Welcome"
                }
              },
              {
                "block": "icon-badge",
                "vars": {
                  "color": "blue",
                  "label": "New"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-section-header\" class=\"text-center mb-8\"><h2>Welcome</h2></div><div data-testid=\"block-icon-badge\" class=\"badge-blue\">New</div>",
        "assertions": [
          "Blocks array contains 2 definitions (icon-badge, section-header)",
          "Each block follows block.schema.json structure (name, type, props/children/content)",
          "Both blocks can be referenced from page sections",
          "Array structure is validated at build time (JSON Schema validation)",
          "Empty blocks array [] is also valid (0+ blocks allowed)"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-002",
      "given": "blocks for DRY principle",
      "when": "blocks are defined once and reused multiple times",
      "then": "it should render same block definition across multiple page locations",
      "application": {
        "blocks": [
          {
            "name": "cta-button",
            "type": "button",
            "props": {
              "className": "btn-$variant"
            },
            "content": "$label"
          }
        ],
        "pages": [
          {
            "name": "Home",
            "path": "/",
            "sections": [
              {
                "block": "cta-button",
                "vars": {
                  "variant": "primary",
                  "label": "Get Started"
                }
              },
              {
                "block": "cta-button",
                "vars": {
                  "variant": "secondary",
                  "label": "Learn More"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<button data-testid=\"block-cta-button-0\" class=\"btn-primary\">Get Started</button><button data-testid=\"block-cta-button-1\" class=\"btn-secondary\">Learn More</button>",
        "assertions": [
          "DRY principle: ONE block definition (cta-button) used TWICE",
          "First instance: data-testid='block-cta-button-0', class='btn-primary', label='Get Started'",
          "Second instance: data-testid='block-cta-button-1', class='btn-secondary', label='Learn More'",
          "Both render from same template WITHOUT code duplication",
          "Updating block definition updates ALL instances automatically"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-003",
      "given": "block with variable substitution",
      "when": "block contains $variable placeholders in props and content",
      "then": "it should render concrete component with substituted values",
      "application": {
        "blocks": [
          {
            "name": "icon-badge",
            "type": "badge",
            "props": {
              "className": "badge-$color"
            },
            "children": [
              {
                "type": "icon",
                "props": {
                  "name": "$icon"
                }
              },
              {
                "type": "text",
                "content": "$text"
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Features",
            "path": "/features",
            "sections": [
              {
                "block": "icon-badge",
                "vars": {
                  "color": "blue",
                  "icon": "star",
                  "text": "Featured"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-icon-badge\" class=\"badge-blue\"><svg data-testid=\"icon-star\"></svg><span>Featured</span></div>",
        "assertions": [
          "Variable substitution in 3 locations:",
          "  1. Props: className 'badge-$color' → 'badge-blue'",
          "  2. Child icon props: name '$icon' → 'star'",
          "  3. Child text content: '$text' → 'Featured'",
          "Badge element: data-testid='block-icon-badge'",
          "Icon element: data-testid='icon-star' (from substituted name)",
          "All $variable placeholders replaced with actual values at render time"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-004",
      "given": "icon-badge block example",
      "when": "block has type 'badge' with $color, $icon, and $text variables",
      "then": "it should render badge with icon and text using substituted values",
      "application": {
        "blocks": [
          {
            "name": "icon-badge",
            "type": "badge",
            "props": {
              "color": "$color"
            },
            "children": [
              {
                "type": "icon",
                "props": {
                  "name": "$icon",
                  "size": 4
                }
              },
              {
                "type": "text",
                "props": {
                  "level": "span"
                },
                "content": "$text"
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Workshop",
            "path": "/workshop",
            "sections": [
              {
                "block": "icon-badge",
                "vars": {
                  "color": "orange",
                  "icon": "users",
                  "text": "6 à 15 personnes"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-icon-badge\" data-color=\"orange\"><svg data-testid=\"icon-users\" width=\"16\" height=\"16\"></svg><span>6 à 15 personnes</span></div>",
        "assertions": [
          "Real-world icon-badge example from workshop page",
          "Badge: data-testid='block-icon-badge', data-color='orange'",
          "Icon: data-testid='icon-users', size=4 (renders as 16x16px)",
          "Text: '6 à 15 personnes' (French UTF-8 content with 'à')",
          "Demonstrates practical use case for group size indicators"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-005",
      "given": "section-header block example",
      "when": "block has nested children with $title, $subtitle, $titleColor variables",
      "then": "it should render section header with styled title and subtitle",
      "application": {
        "blocks": [
          {
            "name": "section-header",
            "type": "container",
            "props": {
              "className": "text-center mb-12"
            },
            "children": [
              {
                "type": "text",
                "props": {
                  "level": "h2",
                  "className": "text-$titleColor text-4xl mb-4"
                },
                "content": "$title"
              },
              {
                "type": "text",
                "props": {
                  "level": "p"
                },
                "content": "$subtitle"
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Mission",
            "path": "/mission",
            "sections": [
              {
                "block": "section-header",
                "vars": {
                  "titleColor": "purple",
                  "title": "Notre Mission",
                  "subtitle": "Rendre la culture du consentement accessible à tous"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-section-header\" class=\"text-center mb-12\"><h2 class=\"text-purple text-4xl mb-4\">Notre Mission</h2><p>Rendre la culture du consentement accessible à tous</p></div>",
        "assertions": [
          "Real-world section header from mission page (French content)",
          "Container: data-testid='block-section-header', class='text-center mb-12'",
          "H2: class includes 'text-purple' (substituted $titleColor), text='Notre Mission'",
          "Paragraph: subtitle with French text (UTF-8 support)",
          "Nested children pattern: container → h2 + p"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-006",
      "given": "blocks as component library",
      "when": "multiple blocks define UI patterns",
      "then": "it should provide consistent, reusable components across pages",
      "application": {
        "blocks": [
          {
            "name": "cta-button",
            "type": "button",
            "content": "$label"
          },
          {
            "name": "icon-badge",
            "type": "badge",
            "props": {
              "color": "$color"
            }
          },
          {
            "name": "feature-card",
            "type": "card",
            "children": []
          }
        ],
        "pages": [
          {
            "name": "Marketing",
            "path": "/marketing",
            "sections": [
              {
                "block": "cta-button",
                "vars": {
                  "label": "Sign Up"
                }
              },
              {
                "block": "icon-badge",
                "vars": {
                  "color": "green"
                }
              },
              {
                "block": "feature-card",
                "vars": {}
              }
            ]
          }
        ],
        "expectedDOM": "<button data-testid=\"block-cta-button\">Sign Up</button><div data-testid=\"block-icon-badge\" data-color=\"green\"></div><div data-testid=\"block-feature-card\"></div>",
        "assertions": [
          "Component library: 3 blocks define reusable UI patterns",
          "Consistent naming: ALL blocks follow 'block-{name}' testid pattern",
          "cta-button: Generic button pattern for calls-to-action",
          "icon-badge: Badge pattern with color customization",
          "feature-card: Card pattern for feature displays",
          "Design system consistency maintained across all components"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-007",
      "given": "blocks with centralized updates",
      "when": "block definition is modified",
      "then": "it should reflect changes across all block instances on page rebuild",
      "application": {
        "blocks": [
          {
            "name": "alert-box",
            "type": "div",
            "props": {
              "className": "alert alert-$variant rounded-lg p-4"
            },
            "content": "$message"
          }
        ],
        "pages": [
          {
            "name": "Alerts Demo",
            "path": "/alerts",
            "sections": [
              {
                "block": "alert-box",
                "vars": {
                  "variant": "info",
                  "message": "Hello"
                }
              },
              {
                "block": "alert-box",
                "vars": {
                  "variant": "warning",
                  "message": "Caution"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-alert-box-0\" class=\"alert alert-info rounded-lg p-4\">Hello</div><div data-testid=\"block-alert-box-1\" class=\"alert alert-warning rounded-lg p-4\">Caution</div>",
        "assertions": [
          "Centralized updates: ONE block definition change affects ALL instances",
          "Scenario: Developer adds 'rounded-lg p-4' to alert-box className",
          "Result: BOTH instances (info + warning) automatically get new classes",
          "Instance 0: class='alert alert-info rounded-lg p-4'",
          "Instance 1: class='alert alert-warning rounded-lg p-4'",
          "No manual updates needed in pages (DRY principle in action)",
          "Single source of truth enables consistent design system updates"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-008",
      "given": "blocks for composition",
      "when": "blocks combine multiple child components",
      "then": "it should render complex nested component structures",
      "application": {
        "blocks": [
          {
            "name": "card-with-header",
            "type": "card",
            "children": [
              {
                "type": "div",
                "props": {
                  "className": "card-header"
                },
                "children": [
                  {
                    "type": "text",
                    "props": {
                      "level": "h3"
                    },
                    "content": "$title"
                  },
                  {
                    "type": "text",
                    "props": {
                      "level": "p"
                    },
                    "content": "$subtitle"
                  }
                ]
              },
              {
                "type": "div",
                "props": {
                  "className": "card-body"
                },
                "content": "$bodyText"
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Features",
            "path": "/features",
            "sections": [
              {
                "block": "card-with-header",
                "vars": {
                  "title": "Feature",
                  "subtitle": "New",
                  "bodyText": "Description text"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-card-with-header\" class=\"card\"><div class=\"card-header\"><h3>Feature</h3><p>New</p></div><div class=\"card-body\">Description text</div></div>",
        "assertions": [
          "Composition: Complex nested structure built from simple components",
          "Level 1 (card): data-testid='block-card-with-header', class='card'",
          "Level 2 (header div): contains h3 + p elements",
          "Level 3 (h3 + p): title='Feature', subtitle='New'",
          "Level 2 (body div): contains body text='Description text'",
          "3 levels of nesting demonstrate component composition power",
          "Single block definition encapsulates complex structure"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-009",
      "given": "blocks for maintainability",
      "when": "blocks encapsulate UI patterns",
      "then": "it should reduce code duplication and simplify pattern updates",
      "application": {
        "blocks": [
          {
            "name": "primary-cta",
            "type": "button",
            "props": {
              "className": "btn-primary btn-lg px-8 py-3 rounded-full shadow-lg hover:shadow-xl transition-shadow"
            },
            "content": "$label"
          }
        ],
        "pages": [
          {
            "name": "Home",
            "path": "/",
            "sections": [
              {
                "block": "primary-cta",
                "vars": {
                  "label": "Get Started"
                }
              }
            ]
          },
          {
            "name": "Pricing",
            "path": "/pricing",
            "sections": [
              {
                "block": "primary-cta",
                "vars": {
                  "label": "Start Free Trial"
                }
              },
              {
                "block": "primary-cta",
                "vars": {
                  "label": "Contact Sales"
                }
              }
            ]
          },
          {
            "name": "About",
            "path": "/about",
            "sections": [
              {
                "block": "primary-cta",
                "vars": {
                  "label": "Join Our Team"
                }
              },
              {
                "block": "primary-cta",
                "vars": {
                  "label": "Learn More"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<button data-testid=\"block-primary-cta\" class=\"btn-primary btn-lg px-8 py-3 rounded-full shadow-lg hover:shadow-xl transition-shadow\">Get Started</button>",
        "assertions": [
          "Maintainability: Same button pattern used 5 times across 3 pages",
          "Without blocks: ~50 lines (10 lines × 5 inline definitions)",
          "With blocks: ~20 lines (1 definition + 5 references at 2 lines each)",
          "Code reduction: 60% fewer lines to maintain",
          "Pattern updates: Change 1 location vs 5 locations",
          "Single source of truth reduces bugs and inconsistencies",
          "Maintenance overhead scales inversely with reuse count"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-010",
      "given": "blocks array at app level",
      "when": "blocks are defined globally in app configuration",
      "then": "it should make blocks available for reference in all page sections",
      "application": {
        "blocks": [
          {
            "name": "global-cta",
            "type": "button",
            "props": {
              "className": "btn-primary"
            },
            "content": "$label"
          }
        ],
        "pages": [
          {
            "name": "Home",
            "path": "/home",
            "sections": [
              {
                "block": "global-cta",
                "vars": {
                  "label": "Home CTA"
                }
              }
            ]
          },
          {
            "name": "About",
            "path": "/about",
            "sections": [
              {
                "block": "global-cta",
                "vars": {
                  "label": "About CTA"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<button data-testid=\"block-global-cta\" class=\"btn-primary\">Home CTA</button>",
        "assertions": [
          "Global scope: Blocks defined at app.blocks[] level",
          "Available everywhere: ALL pages can reference global blocks",
          "Same block 'global-cta' used in /home and /about pages",
          "Both pages use identical data-testid='block-global-cta'",
          "Block availability is global, not page-scoped",
          "Enables shared component library across entire app"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-INTEGRATION-001",
      "given": "blocks integrated with pages via sections",
      "when": "page sections reference blocks using block and vars",
      "then": "it should render blocks within page layout with full variable substitution",
      "application": {
        "blocks": [
          {
            "name": "hero-cta",
            "type": "button",
            "props": {
              "className": "btn btn-$variant text-$size"
            },
            "content": "$ctaText"
          }
        ],
        "pages": [
          {
            "name": "Home",
            "path": "/",
            "sections": [
              {
                "block": "hero-cta",
                "vars": {
                  "variant": "primary",
                  "size": "lg",
                  "ctaText": "Get Started"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<!DOCTYPE html><html><body><main><button data-testid=\"block-hero-cta\" class=\"btn btn-primary text-lg\">Get Started</button></main></body></html>",
        "assertions": [
          "Integration: Blocks → Pages → Sections flow",
          "Step 1: Block defined at app.blocks[] (global library)",
          "Step 2: Page references block via sections[].block='hero-cta'",
          "Step 3: Block renders within page's <main> content area",
          "Variable substitution: variant → 'primary', size → 'lg', ctaText → 'Get Started'",
          "Result: className='btn btn-primary text-lg', content='Get Started'",
          "Global block library enables component reuse across all pages"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-011",
      "given": "blocks array with duplicate block names",
      "when": "multiple blocks have the same name value",
      "then": "it should validate block naming uniqueness at build time",
      "validation": {
        "setup": {
          "validBlocks": [
            {
              "name": "block-1",
              "type": "div"
            },
            {
              "name": "block-2",
              "type": "span"
            }
          ],
          "invalidBlocks": [
            {
              "name": "duplicate-name",
              "type": "div"
            },
            {
              "name": "duplicate-name",
              "type": "span"
            }
          ]
        },
        "assertions": [
          "Blocks array with unique names validates successfully",
          "Blocks array with duplicate names fails validation",
          "Each block must have a unique name within the blocks array",
          "Uniqueness constraint prevents naming conflicts"
        ]
      },
      "application": {
        "blocks": [
          {
            "name": "block-1",
            "type": "div",
            "content": "First block"
          },
          {
            "name": "block-2",
            "type": "span",
            "content": "Second block"
          }
        ],
        "pages": [
          {
            "name": "Validation Demo",
            "path": "/validation",
            "sections": [
              {
                "block": "block-1",
                "vars": {}
              },
              {
                "block": "block-2",
                "vars": {}
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-block-1\">First block</div><span data-testid=\"block-block-2\">Second block</span>",
        "assertions": [
          "Uniqueness validation: Each block name MUST be unique",
          "Valid: ['block-1', 'block-2'] → Different names ✓",
          "Invalid: ['duplicate-name', 'duplicate-name'] → Same name ✗",
          "Build-time validation prevents duplicate block names",
          "Uniqueness constraint ensures no naming conflicts",
          "Page references rely on unique block names for lookup"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-INTEGRATION-002",
      "given": "blocks using theme design tokens",
      "when": "block props reference theme colors, spacing, and fonts",
      "then": "it should render with design tokens applied from global theme",
      "application": {
        "theme": {
          "colors": {
            "primary": "#007bff",
            "secondary": "#6c757d"
          },
          "spacing": {
            "section": "4rem",
            "gap": "1rem"
          },
          "fonts": {
            "heading": {
              "family": "Inter",
              "weight": 700
            }
          }
        },
        "blocks": [
          {
            "name": "themed-section",
            "type": "section",
            "props": {
              "className": "bg-$bgColor py-[theme.spacing.section]",
              "style": "gap: theme.spacing.gap"
            },
            "children": [
              {
                "type": "text",
                "props": {
                  "level": "h2",
                  "style": "color: theme.colors.primary; font-family: theme.fonts.heading.family"
                },
                "content": "$title"
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Services",
            "path": "/services",
            "sections": [
              {
                "block": "themed-section",
                "vars": {
                  "bgColor": "gray-100",
                  "title": "Our Services"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<section data-testid=\"block-themed-section\" class=\"bg-gray-100 py-[4rem]\" style=\"gap: 1rem\"><h2 style=\"color: #007bff; font-family: Inter\">Our Services</h2></section>",
        "assertions": [
          "Theme integration: Blocks use global design tokens",
          "Section props: className uses theme.spacing.section (4rem) → 'py-[4rem]'",
          "Section style: gap uses theme.spacing.gap (1rem) → 'gap: 1rem'",
          "H2 style: color uses theme.colors.primary (#007bff) → 'color: #007bff'",
          "H2 style: font-family uses theme.fonts.heading.family (Inter)",
          "Consistent design: ALL blocks reference same theme tokens",
          "Maintainability: Changing theme updates ALL blocks automatically",
          "Design system integration: Theme → Blocks → Pages flow"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-INTEGRATION-003",
      "given": "blocks containing meta/SEO data for structured content",
      "when": "block definition includes meta properties for SEO optimization",
      "then": "it should generate structured data and meta tags from block content",
      "validation": {
        "setup": {
          "blocks": [
            {
              "name": "product-card",
              "type": "article",
              "props": {
                "meta": {
                  "title": "$productName",
                  "description": "$productDescription",
                  "image": "$productImage",
                  "price": "$productPrice",
                  "currency": "$productCurrency"
                }
              }
            }
          ]
        },
        "assertions": [
          "Block meta property contains SEO data",
          "Variable references for dynamic content",
          "Structured data generation from block content"
        ]
      },
      "application": {
        "blocks": [
          {
            "name": "product-card",
            "type": "article",
            "props": {
              "meta": {
                "title": "$productName",
                "description": "$productDescription",
                "image": "$productImage",
                "price": "$productPrice",
                "currency": "$productCurrency",
                "structuredData": {
                  "type": "Product",
                  "fields": ["name", "description", "image", "offers"]
                }
              }
            }
          }
        ],
        "page": {
          "sections": [
            {
              "block": "product-card",
              "vars": {
                "productName": "Wireless Headphones",
                "productDescription": "Premium noise-cancelling headphones",
                "productImage": "/images/headphones.jpg",
                "productPrice": "299.99",
                "productCurrency": "USD"
              }
            }
          ]
        },
        "expectedMeta": {
          "title": "Wireless Headphones",
          "description": "Premium noise-cancelling headphones",
          "og:image": "/images/headphones.jpg",
          "structuredData": {
            "@type": "Product",
            "name": "Wireless Headphones",
            "description": "Premium noise-cancelling headphones",
            "image": "/images/headphones.jpg",
            "offers": {
              "@type": "Offer",
              "price": "299.99",
              "priceCurrency": "USD"
            }
          }
        },
        "expectedDOM": "<article data-testid=\"block-product-card\">\n  <script type=\"application/ld+json\">\n    {\n      \"@context\": \"https://schema.org\",\n      \"@type\": \"Product\",\n      \"name\": \"Wireless Headphones\",\n      \"description\": \"Premium noise-cancelling headphones\",\n      \"image\": \"/images/headphones.jpg\",\n      \"offers\": {\n        \"@type\": \"Offer\",\n        \"price\": \"299.99\",\n        \"priceCurrency\": \"USD\"\n      }\n    }\n  </script>\n</article>",
        "assertions": [
          "Blocks+Meta integration: Block meta generates page meta tags",
          "Structured data: Block props → Schema.org JSON-LD",
          "Dynamic SEO: Variable substitution in meta content",
          "Product schema: Name, description, image, price from block vars",
          "Open Graph: og:image from block meta",
          "Reusable SEO: Same block, different products → different structured data",
          "E-commerce optimization: Product blocks include offer data",
          "Search engine visibility: Proper structured data markup"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-REGRESSION-001",
      "given": "complete application configuration with all features",
      "when": "user completes full workflow",
      "then": "user can complete full blocks workflow",
      "workflow": [
        {
          "step": 1,
          "action": "Developer defines reusable blocks in global app.blocks[] array",
          "validation": "Each block has unique name, type, and template structure (props/children/content with $variable placeholders)",
          "expectedState": "Block library created with 3 reusable blocks: hero-section, feature-card, cta-button"
        },
        {
          "step": 2,
          "action": "Developer references blocks from page sections using block name and vars object",
          "validation": "Page sections reference blocks by name, provide concrete values for $variable placeholders",
          "expectedState": "Homepage references hero-section block with specific title, subtitle, and CTA text"
        },
        {
          "step": 3,
          "action": "System performs variable substitution: $variables replaced with concrete values from vars",
          "validation": "All $variable placeholders in props, content, and children replaced with actual values",
          "expectedState": "Hero block renders with substituted values: title='Welcome', subtitle='Build apps', cta='Get Started'"
        },
        {
          "step": 4,
          "action": "System renders block instances with unique data-testid for instance tracking",
          "validation": "Each block instance has data-testid='block-{name}' or 'block-{name}-{instance}' for multiple uses",
          "expectedState": "Three block instances rendered: hero-section (once), feature-card (twice with different data)"
        },
        {
          "step": 5,
          "action": "Developer updates block definition in app.blocks[] array",
          "validation": "Single block definition change automatically applies to ALL instances across all pages",
          "expectedState": "All cta-button instances updated with new className after changing block definition once"
        }
      ],
      "application": {
        "completeExample": {
          "blocks": [
            {
              "name": "hero-section",
              "type": "section",
              "props": {
                "className": "hero bg-gradient py-20 text-center",
                "data-testid": "hero-section"
              },
              "children": [
                {
                  "type": "container",
                  "props": {
                    "className": "container mx-auto"
                  },
                  "children": [
                    {
                      "type": "text",
                      "props": {
                        "level": "h1",
                        "className": "text-5xl font-bold mb-4 text-$titleColor"
                      },
                      "content": "$title"
                    },
                    {
                      "type": "text",
                      "props": {
                        "level": "p",
                        "className": "text-xl mb-8"
                      },
                      "content": "$subtitle"
                    },
                    {
                      "type": "button",
                      "props": {
                        "className": "btn btn-$ctaVariant btn-lg px-8 py-3"
                      },
                      "content": "$ctaText"
                    }
                  ]
                }
              ]
            },
            {
              "name": "feature-card",
              "type": "card",
              "props": {
                "className": "feature-card rounded-lg shadow-lg p-6 bg-white"
              },
              "children": [
                {
                  "type": "icon",
                  "props": {
                    "name": "$icon",
                    "size": 8,
                    "className": "text-$iconColor mb-4"
                  }
                },
                {
                  "type": "text",
                  "props": {
                    "level": "h3",
                    "className": "text-2xl font-semibold mb-2"
                  },
                  "content": "$title"
                },
                {
                  "type": "text",
                  "props": {
                    "level": "p",
                    "className": "text-gray-600"
                  },
                  "content": "$description"
                }
              ]
            },
            {
              "name": "cta-button",
              "type": "button",
              "props": {
                "className": "btn btn-$variant px-6 py-2 rounded-lg transition-all hover:scale-105"
              },
              "content": "$label"
            }
          ],
          "pages": [
            {
              "name": "Home",
              "path": "/",
              "sections": [
                {
                  "block": "hero-section",
                  "vars": {
                    "title": "Welcome to Omnera",
                    "titleColor": "primary",
                    "subtitle": "Build powerful applications with configuration",
                    "ctaText": "Get Started",
                    "ctaVariant": "primary"
                  }
                },
                {
                  "type": "container",
                  "props": {
                    "className": "features-grid grid grid-cols-3 gap-8 py-16"
                  },
                  "children": [
                    {
                      "block": "feature-card",
                      "vars": {
                        "icon": "zap",
                        "iconColor": "yellow-500",
                        "title": "Fast Development",
                        "description": "Build applications in minutes, not days"
                      }
                    },
                    {
                      "block": "feature-card",
                      "vars": {
                        "icon": "shield",
                        "iconColor": "green-500",
                        "title": "Secure by Default",
                        "description": "Enterprise-grade security built-in"
                      }
                    },
                    {
                      "block": "feature-card",
                      "vars": {
                        "icon": "layers",
                        "iconColor": "blue-500",
                        "title": "Highly Composable",
                        "description": "Mix and match components effortlessly"
                      }
                    }
                  ]
                },
                {
                  "type": "container",
                  "props": {
                    "className": "cta-section text-center py-12"
                  },
                  "children": [
                    {
                      "block": "cta-button",
                      "vars": {
                        "variant": "primary",
                        "label": "Start Building"
                      }
                    },
                    {
                      "block": "cta-button",
                      "vars": {
                        "variant": "secondary",
                        "label": "View Documentation"
                      }
                    }
                  ]
                }
              ]
            }
          ]
        },
        "expectedDOM": "<main>\n  <section data-testid=\"hero-section\" class=\"hero bg-gradient py-20 text-center\">\n    <div class=\"container mx-auto\">\n      <h1 class=\"text-5xl font-bold mb-4 text-primary\">Welcome to Omnera</h1>\n      <p class=\"text-xl mb-8\">Build powerful applications with configuration</p>\n      <button class=\"btn btn-primary btn-lg px-8 py-3\">Get Started</button>\n    </div>\n  </section>\n  \n  <div class=\"features-grid grid grid-cols-3 gap-8 py-16\">\n    <div data-testid=\"block-feature-card-0\" class=\"feature-card rounded-lg shadow-lg p-6 bg-white\">\n      <svg data-testid=\"icon-zap\" width=\"32\" height=\"32\" class=\"text-yellow-500 mb-4\"></svg>\n      <h3 class=\"text-2xl font-semibold mb-2\">Fast Development</h3>\n      <p class=\"text-gray-600\">Build applications in minutes, not days</p>\n    </div>\n    <div data-testid=\"block-feature-card-1\" class=\"feature-card rounded-lg shadow-lg p-6 bg-white\">\n      <svg data-testid=\"icon-shield\" width=\"32\" height=\"32\" class=\"text-green-500 mb-4\"></svg>\n      <h3 class=\"text-2xl font-semibold mb-2\">Secure by Default</h3>\n      <p class=\"text-gray-600\">Enterprise-grade security built-in</p>\n    </div>\n    <div data-testid=\"block-feature-card-2\" class=\"feature-card rounded-lg shadow-lg p-6 bg-white\">\n      <svg data-testid=\"icon-layers\" width=\"32\" height=\"32\" class=\"text-blue-500 mb-4\"></svg>\n      <h3 class=\"text-2xl font-semibold mb-2\">Highly Composable</h3>\n      <p class=\"text-gray-600\">Mix and match components effortlessly</p>\n    </div>\n  </div>\n  \n  <div class=\"cta-section text-center py-12\">\n    <button data-testid=\"block-cta-button-0\" class=\"btn btn-primary px-6 py-2 rounded-lg transition-all hover:scale-105\">Start Building</button>\n    <button data-testid=\"block-cta-button-1\" class=\"btn btn-secondary px-6 py-2 rounded-lg transition-all hover:scale-105\">View Documentation</button>\n  </div>\n</main>",
        "assertions": [
          "Blocks array validates with 3 reusable block definitions (hero-section, feature-card, cta-button)",
          "Each block has unique name, type, and template structure following block.schema.json",
          "Variable substitution works across all property types: props, content, children",
          "Hero section renders once with substituted values: title, titleColor, subtitle, ctaText, ctaVariant",
          "Feature cards render 3 times with different data: icon, iconColor, title, description per instance",
          "CTA buttons render 2 times with different variants: primary and secondary",
          "Instance tracking via data-testid: block-feature-card-0, block-feature-card-1, block-feature-card-2",
          "Multiple instances use same block definition with different vars (DRY principle)",
          "Nested children composition: hero-section contains container > h1 + p + button",
          "Props override: className with $variable placeholders replaced (text-$titleColor → text-primary)",
          "Block reusability: Same feature-card template used 3 times with unique content",
          "Centralized updates: Changing block definition updates ALL instances automatically",
          "Complete workflow from block library definition to rendered multi-instance page works",
          "Block architecture mirrors Webflow symbols/components for familiar developer experience",
          "Component library pattern: Global blocks available to all pages",
          "Variable substitution supports deeply nested children structures"
        ]
      },
      "integrationPoints": [
        "Page sections integration: Blocks referenced via sections[].block property with vars object",
        "Component library pattern: app.blocks[] as global reusable component registry",
        "Props system: $variable placeholders in block props resolved from vars at render time",
        "Children nesting: Blocks support complex nested children structures for composition",
        "Theme integration: Blocks use theme tokens (colors, spacing) via $variable or theme references",
        "Meta/SEO from blocks: Blocks can include meta properties for structured data generation",
        "Data-testid tracking: Consistent testid pattern (block-{name}-{instance}) for E2E testing",
        "Variable substitution engine: $variable pattern resolved across props, content, children",
        "Webflow-like symbols: Block architecture inspired by Webflow reusable symbols pattern",
        "Design system consistency: Blocks enforce consistent UI patterns across application",
        "Maintainability: Single source of truth for component definitions reduces duplication",
        "Type safety: Block definitions validate against block.schema.json at build time"
      ]
    }
  ]
}
