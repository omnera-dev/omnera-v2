{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "block.schema.json",
  "title": "Block Template",
  "description": "A reusable UI component template with variable placeholders",
  "type": "object",
  "properties": {
    "name": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9-]*$",
      "description": "Unique block identifier in kebab-case",
      "examples": ["icon-badge", "section-header", "feature-card"]
    },
    "type": {
      "type": "string",
      "description": "Component type",
      "examples": ["container", "flex", "grid", "card", "text", "button"]
    },
    "props": {
      "$ref": "../common/block-props.schema.json"
    },
    "children": {
      "$ref": "../common/block-children.schema.json"
    },
    "content": {
      "type": "string",
      "description": "Text content (may contain $variable references)"
    }
  },
  "required": ["name", "type"],
  "additionalProperties": false,
  "examples": [
    {
      "name": "simple-text",
      "type": "text",
      "props": {
        "className": "text-$color text-lg"
      },
      "content": "$message"
    },
    {
      "name": "feature-list-item",
      "type": "flex",
      "props": {
        "align": "start",
        "gap": 3
      },
      "children": [
        {
          "type": "icon",
          "props": {
            "name": "$icon",
            "color": "$iconColor"
          }
        },
        {
          "type": "text",
          "content": "$text"
        }
      ]
    }
  ],
  "x-specs": [
    {
      "id": "APP-BLOCKS-BLOCK-001",
      "given": "block with required properties",
      "when": "name and type are provided",
      "then": "it should validate minimal block definition at build time",
      "validation": {
        "setup": {
          "block": {
            "name": "simple-block",
            "type": "div"
          }
        },
        "assertions": [
          "Block validates with only name and type",
          "Name and type are required properties",
          "Props, children, and content are optional"
        ]
      },
      "application": {
        "blocks": [
          {
            "name": "simple-block",
            "type": "div"
          }
        ],
        "pages": [
          {
            "name": "Home",
            "path": "/",
            "sections": [
              {
                "block": "simple-block"
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-simple-block\"></div>",
        "assertions": [
          "Minimal block renders as div element",
          "Block has data-testid attribute: data-testid=\"block-simple-block\"",
          "No props, children, or content needed",
          "Block definition: name + type = minimal viable block"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-BLOCK-002",
      "given": "block name in kebab-case",
      "when": "name is 'icon-badge', 'section-header', or 'feature-card'",
      "then": "it should use URL-friendly naming convention for data-testid",
      "validation": {
        "setup": {
          "blocks": [
            {
              "name": "icon-badge",
              "type": "badge"
            },
            {
              "name": "section-header",
              "type": "container"
            },
            {
              "name": "feature-card",
              "type": "card"
            }
          ]
        },
        "assertions": [
          "All block names use kebab-case (lowercase with hyphens)",
          "data-testid attributes directly match block names: 'block-{name}'",
          "Kebab-case enables clean, predictable CSS selectors"
        ]
      },
      "application": {
        "blocks": [
          {
            "name": "icon-badge",
            "type": "badge"
          },
          {
            "name": "section-header",
            "type": "container"
          },
          {
            "name": "feature-card",
            "type": "card"
          }
        ],
        "pages": [
          {
            "name": "Home",
            "path": "/",
            "sections": [
              {
                "block": "icon-badge"
              },
              {
                "block": "section-header"
              },
              {
                "block": "feature-card"
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-icon-badge\"></div><div data-testid=\"block-section-header\"></div><div data-testid=\"block-feature-card\"></div>",
        "assertions": [
          "Kebab-case naming: 'icon-badge', 'section-header', 'feature-card'",
          "Lowercase with hyphens (no spaces, no underscores, no uppercase)",
          "data-testid follows pattern: 'block-{name}'",
          "URL-friendly: Can be used in CSS selectors, URLs, file names",
          "Predictable: [data-testid='block-icon-badge'] selector works reliably",
          "Naming convention enforced by schema pattern ^[a-z][a-z0-9-]*$"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-BLOCK-003",
      "given": "block name pattern validation",
      "when": "name matches ^[a-z][a-z0-9-]*$ (lowercase, hyphens, no spaces)",
      "then": "it should reject invalid names at build time",
      "validation": {
        "setup": {
          "validNames": ["icon-badge", "cta", "section-header-2", "feature-list-item"],
          "invalidNames": ["Icon-Badge", "cta_button", "section header", "2-columns", ""]
        },
        "assertions": [
          "Valid: 'icon-badge', 'cta', 'section-header-2', 'feature-list-item'",
          "Invalid: 'Icon-Badge' (uppercase), 'cta_button' (underscore), 'section header' (space)",
          "Invalid: '2-columns' (starts with digit), '' (empty string)",
          "Pattern enforces: start with lowercase letter, only lowercase/digits/hyphens"
        ]
      },
      "application": {
        "blocks": [
          {
            "name": "cta",
            "type": "button"
          },
          {
            "name": "section-header-2",
            "type": "container"
          },
          {
            "name": "feature-list-item",
            "type": "flex"
          }
        ],
        "pages": [
          {
            "name": "Home",
            "path": "/",
            "sections": [
              {
                "block": "cta"
              },
              {
                "block": "section-header-2"
              },
              {
                "block": "feature-list-item"
              }
            ]
          }
        ],
        "expectedDOM": "<button data-testid=\"block-cta\"></button><div data-testid=\"block-section-header-2\"></div><div data-testid=\"block-feature-list-item\"></div>",
        "assertions": [
          "Pattern ^[a-z][a-z0-9-]*$ enforced at build time",
          "Valid: 'cta' (short, lowercase)",
          "Valid: 'section-header-2' (multiple hyphens, ending with digit)",
          "Valid: 'feature-list-item' (multi-word, descriptive)",
          "Build fails if invalid names used (uppercase, underscores, spaces, starting with digit)",
          "Pattern ensures: URL-safe, CSS-safe, predictable naming"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-BLOCK-004",
      "given": "block type specification",
      "when": "type is 'container', 'flex', 'grid', 'card', 'text', 'button', etc.",
      "then": "it should render corresponding HTML element or component",
      "validation": {
        "setup": {
          "blocks": [
            {
              "name": "layout",
              "type": "container"
            },
            {
              "name": "row",
              "type": "flex"
            },
            {
              "name": "columns",
              "type": "grid"
            },
            {
              "name": "panel",
              "type": "card"
            },
            {
              "name": "heading",
              "type": "text"
            },
            {
              "name": "cta",
              "type": "button"
            }
          ]
        },
        "assertions": [
          "Each block renders with data-type attribute matching type property",
          "Type determines base HTML element (div, span, button, etc.)",
          "Type also controls CSS classes and behavior (flexbox, grid, card styles)"
        ]
      },
      "application": {
        "blocks": [
          {
            "name": "layout",
            "type": "container"
          },
          {
            "name": "row",
            "type": "flex"
          },
          {
            "name": "columns",
            "type": "grid"
          },
          {
            "name": "panel",
            "type": "card"
          },
          {
            "name": "heading",
            "type": "text"
          },
          {
            "name": "cta",
            "type": "button"
          }
        ],
        "pages": [
          {
            "name": "Home",
            "path": "/",
            "sections": [
              {
                "block": "layout"
              },
              {
                "block": "row"
              },
              {
                "block": "columns"
              },
              {
                "block": "panel"
              },
              {
                "block": "heading"
              },
              {
                "block": "cta"
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-layout\" data-type=\"container\"></div><div data-testid=\"block-row\" data-type=\"flex\"></div><div data-testid=\"block-columns\" data-type=\"grid\"></div><div data-testid=\"block-panel\" data-type=\"card\"></div><span data-testid=\"block-heading\" data-type=\"text\"></span><button data-testid=\"block-cta\" data-type=\"button\"></button>",
        "assertions": [
          "Type property determines HTML element and behavior",
          "container → div (generic container)",
          "flex → div with display: flex (flexbox layout)",
          "grid → div with display: grid (grid layout)",
          "card → div with card styling (bordered, shadowed container)",
          "text → span or p (text content)",
          "button → button (interactive element)",
          "data-type attribute preserves type for CSS styling and JS behavior",
          "Type enables semantic, layout-specific blocks"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-BLOCK-005",
      "given": "block with props",
      "when": "props references block-props.schema.json",
      "then": "it should render with properties including variable substitution",
      "validation": {
        "setup": {
          "blockDefinition": {
            "name": "styled-box",
            "type": "div",
            "props": {
              "className": "box-$variant",
              "id": "$boxId",
              "ariaLabel": "$label"
            }
          },
          "reference": {
            "$ref": "styled-box",
            "vars": {
              "variant": "primary",
              "boxId": "main-box",
              "label": "Main content"
            }
          }
        },
        "assertions": [
          "className substituted: 'box-$variant' → 'box-primary'",
          "id substituted: '$boxId' → 'main-box'",
          "ariaLabel substituted: '$label' → 'Main content'",
          "All prop values support variable substitution"
        ]
      },
      "application": {
        "blocks": [
          {
            "name": "styled-box",
            "type": "div",
            "props": {
              "className": "box-$variant",
              "id": "$boxId",
              "ariaLabel": "$label"
            }
          }
        ],
        "pages": [
          {
            "name": "Home",
            "path": "/",
            "sections": [
              {
                "block": "styled-box",
                "vars": {
                  "variant": "primary",
                  "boxId": "main-box",
                  "label": "Main content"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-styled-box\" class=\"box-primary\" id=\"main-box\" aria-label=\"Main content\"></div>",
        "assertions": [
          "Block template defines props with $variable placeholders",
          "Page section references block with vars object",
          "Variable substitution: className 'box-$variant' → 'box-primary'",
          "Variable substitution: id '$boxId' → 'main-box'",
          "Variable substitution: ariaLabel '$label' → 'Main content'",
          "Props enable dynamic, reusable block templates",
          "Same block can be reused with different vars"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-BLOCK-006",
      "given": "block with children",
      "when": "children references block-children.schema.json",
      "then": "it should render nested child components",
      "validation": {
        "setup": {
          "blockDefinition": {
            "name": "card-header",
            "type": "div",
            "children": [
              {
                "type": "text",
                "props": {
                  "level": "h3"
                },
                "content": "$title"
              },
              {
                "type": "text",
                "props": {
                  "level": "p"
                },
                "content": "$subtitle"
              }
            ]
          },
          "reference": {
            "$ref": "card-header",
            "vars": {
              "title": "Card Title",
              "subtitle": "Card subtitle"
            }
          }
        },
        "assertions": [
          "Parent div has data-testid='block-card-header'",
          "Children array renders h3 and p elements",
          "Child content substituted from vars (title, subtitle)",
          "Nested structure maintained in DOM"
        ]
      },
      "application": {
        "blocks": [
          {
            "name": "card-header",
            "type": "div",
            "children": [
              {
                "type": "text",
                "props": {
                  "level": "h3"
                },
                "content": "$title"
              },
              {
                "type": "text",
                "props": {
                  "level": "p"
                },
                "content": "$subtitle"
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Home",
            "path": "/",
            "sections": [
              {
                "block": "card-header",
                "vars": {
                  "title": "Card Title",
                  "subtitle": "Card subtitle"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-card-header\"><h3>Card Title</h3><p>Card subtitle</p></div>",
        "assertions": [
          "Block template defines children array with nested components",
          "Parent div renders with data-testid='block-card-header'",
          "First child: h3 element with $title variable",
          "Second child: p element with $subtitle variable",
          "Variable substitution: '$title' → 'Card Title', '$subtitle' → 'Card subtitle'",
          "Nested structure preserved in final DOM",
          "Children enable block composition and hierarchy"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-BLOCK-007",
      "given": "block with content",
      "when": "content is string with $variable references",
      "then": "it should render text content with substituted variables",
      "validation": {
        "setup": {
          "blockDefinition": {
            "name": "alert-message",
            "type": "div",
            "props": {
              "className": "alert"
            },
            "content": "$message"
          },
          "reference": {
            "$ref": "alert-message",
            "vars": {
              "message": "Operation successful!"
            }
          }
        },
        "assertions": [
          "Div has data-testid='block-alert-message'",
          "Content substituted: '$message' → 'Operation successful!'",
          "Text content rendered inside div element"
        ]
      },
      "application": {
        "blocks": [
          {
            "name": "alert-message",
            "type": "div",
            "props": {
              "className": "alert"
            },
            "content": "$message"
          }
        ],
        "pages": [
          {
            "name": "Home",
            "path": "/",
            "sections": [
              {
                "block": "alert-message",
                "vars": {
                  "message": "Operation successful!"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-alert-message\" class=\"alert\">Operation successful!</div>",
        "assertions": [
          "Block template defines content property with $variable placeholder",
          "Div renders with className='alert' and data-testid='block-alert-message'",
          "Variable substitution: content '$message' → 'Operation successful!'",
          "Text content rendered as inner text of div element",
          "Content property simpler than children for plain text blocks",
          "Same block reusable with different message vars"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-BLOCK-008",
      "given": "simple text block example",
      "when": "block has type 'text', className with $color, and content with $message",
      "then": "it should render text element with dynamic styling and content",
      "validation": {
        "setup": {
          "blockDefinition": {
            "name": "simple-text",
            "type": "text",
            "props": {
              "className": "text-$color text-lg"
            },
            "content": "$message"
          },
          "reference": {
            "$ref": "simple-text",
            "vars": {
              "color": "blue",
              "message": "Hello World"
            }
          }
        },
        "assertions": [
          "Text element (p tag) has data-testid='block-simple-text'",
          "className substituted: 'text-$color text-lg' → 'text-blue text-lg'",
          "Content substituted: '$message' → 'Hello World'"
        ]
      },
      "application": {
        "blocks": [
          {
            "name": "simple-text",
            "type": "text",
            "props": {
              "className": "text-$color text-lg"
            },
            "content": "$message"
          }
        ],
        "pages": [
          {
            "name": "Home",
            "path": "/",
            "sections": [
              {
                "block": "simple-text",
                "vars": {
                  "color": "blue",
                  "message": "Hello World"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<p data-testid=\"block-simple-text\" class=\"text-blue text-lg\">Hello World</p>",
        "assertions": [
          "Type 'text' renders as paragraph (p) element",
          "Multiple variable substitutions: className and content",
          "className: 'text-$color text-lg' → 'text-blue text-lg'",
          "content: '$message' → 'Hello World'",
          "Combines styling (color, size) with dynamic content",
          "Example from documentation (simple-text block)"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-BLOCK-009",
      "given": "feature-list-item block example",
      "when": "block has type 'flex' with icon and text children using $icon, $iconColor, $text",
      "then": "it should render flex container with icon and text components",
      "validation": {
        "setup": {
          "blockDefinition": {
            "name": "feature-list-item",
            "type": "flex",
            "props": {
              "align": "start",
              "gap": 3
            },
            "children": [
              {
                "type": "icon",
                "props": {
                  "name": "$icon",
                  "color": "$iconColor"
                }
              },
              {
                "type": "text",
                "content": "$text"
              }
            ]
          },
          "reference": {
            "$ref": "feature-list-item",
            "vars": {
              "icon": "check-circle",
              "iconColor": "green",
              "text": "Feature enabled"
            }
          }
        },
        "assertions": [
          "Flex container has data-testid='block-feature-list-item'",
          "Flex container has classes 'flex items-start gap-3'",
          "Icon SVG has data-testid='icon-check-circle' and data-color='green'",
          "Text span contains 'Feature enabled'"
        ]
      },
      "application": {
        "blocks": [
          {
            "name": "feature-list-item",
            "type": "flex",
            "props": {
              "align": "start",
              "gap": 3
            },
            "children": [
              {
                "type": "icon",
                "props": {
                  "name": "$icon",
                  "color": "$iconColor"
                }
              },
              {
                "type": "text",
                "content": "$text"
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Features",
            "path": "/features",
            "sections": [
              {
                "block": "feature-list-item",
                "vars": {
                  "icon": "check-circle",
                  "iconColor": "green",
                  "text": "Feature enabled"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-feature-list-item\" class=\"flex items-start gap-3\"><svg data-testid=\"icon-check-circle\" data-color=\"green\"></svg><span>Feature enabled</span></div>",
        "assertions": [
          "Example from documentation: feature-list-item block",
          "Type 'flex' renders as flexbox container",
          "Props: align='start' (items-start), gap=3 (gap-3)",
          "Children: icon + text components",
          "Icon child: type='icon' with $icon and $iconColor variables",
          "Text child: type='text' with $text content",
          "Variable substitution: $icon → 'check-circle', $iconColor → 'green', $text → 'Feature enabled'",
          "Real-world use case: Feature lists, benefit lists, checkmark items",
          "Reusable pattern: Same block for all feature items with different icons/text"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-BLOCK-010",
      "given": "block as reusable template",
      "when": "block defines structure with variable placeholders",
      "then": "it should render multiple instances with different data",
      "validation": {
        "setup": {
          "blockDefinition": {
            "name": "stat-card",
            "type": "card",
            "children": [
              {
                "type": "text",
                "props": {
                  "level": "h4"
                },
                "content": "$value"
              },
              {
                "type": "text",
                "props": {
                  "level": "p"
                },
                "content": "$label"
              }
            ]
          },
          "references": [
            {
              "$ref": "stat-card",
              "vars": {
                "value": "1,234",
                "label": "Users"
              }
            },
            {
              "$ref": "stat-card",
              "vars": {
                "value": "567",
                "label": "Projects"
              }
            },
            {
              "$ref": "stat-card",
              "vars": {
                "value": "89%",
                "label": "Success Rate"
              }
            }
          ]
        },
        "assertions": [
          "Same block definition renders 3 different instances",
          "Each instance has unique data-testid suffix: -0, -1, -2",
          "Each instance displays different value and label",
          "Template reused without code duplication"
        ]
      },
      "application": {
        "blocks": [
          {
            "name": "stat-card",
            "type": "card",
            "children": [
              {
                "type": "text",
                "props": {
                  "level": "h4"
                },
                "content": "$value"
              },
              {
                "type": "text",
                "props": {
                  "level": "p"
                },
                "content": "$label"
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Dashboard",
            "path": "/dashboard",
            "sections": [
              {
                "block": "stat-card",
                "vars": {
                  "value": "1,234",
                  "label": "Users"
                }
              },
              {
                "block": "stat-card",
                "vars": {
                  "value": "567",
                  "label": "Projects"
                }
              },
              {
                "block": "stat-card",
                "vars": {
                  "value": "89%",
                  "label": "Success Rate"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-stat-card-0\"><h4>1,234</h4><p>Users</p></div><div data-testid=\"block-stat-card-1\"><h4>567</h4><p>Projects</p></div><div data-testid=\"block-stat-card-2\"><h4>89%</h4><p>Success Rate</p></div>",
        "assertions": [
          "ONE block template defined (stat-card)",
          "THREE instances rendered with different data",
          "Instance 0: value='1,234', label='Users'",
          "Instance 1: value='567', label='Projects'",
          "Instance 2: value='89%', label='Success Rate'",
          "Each instance has unique data-testid suffix: -0, -1, -2",
          "DRY principle: Single template reused without code duplication",
          "Template pattern enables data-driven UI (same structure, different content)",
          "Webflow/WordPress-like reusability: define once, use everywhere"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-BLOCK-011",
      "given": "block composition patterns",
      "when": "block combines layout (type), styling (props), and content (children/content)",
      "then": "it should render complete component with all aspects integrated",
      "validation": {
        "setup": {
          "blockDefinition": {
            "name": "complete-card",
            "type": "card",
            "props": {
              "className": "card-$variant p-6 rounded-lg"
            },
            "children": [
              {
                "type": "text",
                "props": {
                  "level": "h3",
                  "className": "mb-2"
                },
                "content": "$title"
              },
              {
                "type": "text",
                "props": {
                  "level": "p"
                },
                "content": "$description"
              }
            ]
          },
          "reference": {
            "$ref": "complete-card",
            "vars": {
              "variant": "primary",
              "title": "Premium Plan",
              "description": "Best value for teams"
            }
          }
        },
        "assertions": [
          "Layout: type='card' renders as div",
          "Styling: className combines variant, padding, and border-radius",
          "Content: children render h3 and p with substituted text",
          "All 3 aspects (layout, styling, content) work together"
        ]
      },
      "application": {
        "blocks": [
          {
            "name": "complete-card",
            "type": "card",
            "props": {
              "className": "card-$variant p-6 rounded-lg"
            },
            "children": [
              {
                "type": "text",
                "props": {
                  "level": "h3",
                  "className": "mb-2"
                },
                "content": "$title"
              },
              {
                "type": "text",
                "props": {
                  "level": "p"
                },
                "content": "$description"
              }
            ]
          }
        ],
        "pages": [
          {
            "name": "Pricing",
            "path": "/pricing",
            "sections": [
              {
                "block": "complete-card",
                "vars": {
                  "variant": "primary",
                  "title": "Premium Plan",
                  "description": "Best value for teams"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-complete-card\" class=\"card-primary p-6 rounded-lg\"><h3 class=\"mb-2\">Premium Plan</h3><p>Best value for teams</p></div>",
        "assertions": [
          "Block composition: layout + styling + content all integrated",
          "Layout: type='card' defines structure (div container)",
          "Styling: props.className defines appearance (card-primary p-6 rounded-lg)",
          "Content: children array defines nested elements (h3 title, p description)",
          "Variable substitution across all layers:",
          "  - Styling: $variant → 'primary' (card-primary class)",
          "  - Content: $title → 'Premium Plan' (h3 text)",
          "  - Content: $description → 'Best value for teams' (p text)",
          "Complete component: All aspects work together for full-featured block",
          "Real-world pattern: Pricing card with variant styling and dynamic content"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-BLOCK-012",
      "given": "block template instantiation",
      "when": "block is referenced via block-reference.schema.json with vars",
      "then": "it should transform template placeholders into concrete values in DOM",
      "validation": {
        "setup": {
          "blockDefinition": {
            "name": "pricing-badge",
            "type": "badge",
            "props": {
              "className": "badge-$color"
            },
            "content": "$price/month"
          },
          "reference": {
            "$ref": "pricing-badge",
            "vars": {
              "color": "gold",
              "price": "49"
            }
          }
        },
        "assertions": [
          "Template: 'badge-$color' → Instance: 'badge-gold'",
          "Template: '$price/month' → Instance: '49/month'",
          "All $variable placeholders replaced with vars values",
          "Final DOM contains no $ symbols or placeholder text"
        ]
      },
      "application": {
        "blocks": [
          {
            "name": "pricing-badge",
            "type": "badge",
            "props": {
              "className": "badge-$color"
            },
            "content": "$price/month"
          }
        ],
        "pages": [
          {
            "name": "Pricing",
            "path": "/pricing",
            "sections": [
              {
                "block": "pricing-badge",
                "vars": {
                  "color": "gold",
                  "price": "49"
                }
              }
            ]
          }
        ],
        "expectedDOM": "<div data-testid=\"block-pricing-badge\" class=\"badge-gold\">49/month</div>",
        "assertions": [
          "Block template instantiation: template + vars = concrete instance",
          "Template definition: className='badge-$color', content='$price/month'",
          "Reference with vars: color='gold', price='49'",
          "Instantiation process:",
          "  Step 1: Start with template (has $variables)",
          "  Step 2: Apply vars from reference",
          "  Step 3: Replace all $variable occurrences",
          "Result: className 'badge-$color' → 'badge-gold'",
          "Result: content '$price/month' → '49/month'",
          "Final DOM has NO $ symbols or placeholder text",
          "Clean transformation: template → instance"
        ]
      }
    },
    {
      "id": "APP-BLOCKS-BLOCK-REGRESSION-001",
      "given": "complete application configuration with all features",
      "when": "user completes full workflow",
      "then": "user can complete full block workflow",
      "workflow": [
        {
          "step": 1,
          "action": "Define reusable block template with name, type, and structure",
          "validation": "Block has unique name in kebab-case, valid type, and template structure (props/children/content with $variables)",
          "expectedState": "Block definition created with name='hero-section', type='section', props/children with $variable placeholders"
        },
        {
          "step": 2,
          "action": "Reference block from page section using block name and vars object",
          "validation": "Page section references block by name, provides concrete values for all $variable placeholders",
          "expectedState": "Homepage references hero-section block with vars: title='Welcome', subtitle='Build apps', ctaText='Get Started'"
        },
        {
          "step": 3,
          "action": "System performs variable substitution: $variables replaced with concrete values from vars",
          "validation": "All $variable placeholders in props, content, and children replaced with actual values",
          "expectedState": "Hero block renders with substituted values: title='Welcome', subtitle='Build apps', cta='Get Started'"
        },
        {
          "step": 4,
          "action": "System renders block instance with data-testid for tracking",
          "validation": "Block instance has data-testid='block-{name}' or 'block-{name}-{instance}' for multiple uses",
          "expectedState": "Hero section rendered with data-testid='block-hero-section', all nested children rendered with substituted values"
        },
        {
          "step": 5,
          "action": "Developer updates block definition centrally (change className, structure, etc.)",
          "validation": "Single block definition change automatically applies to ALL instances across all pages",
          "expectedState": "All hero-section instances updated with new structure after changing block definition once (DRY principle)"
        }
      ],
      "application": {
        "completeExample": {
          "hero-section": {
            "name": "hero-section",
            "type": "section",
            "props": {
              "className": "hero bg-gradient py-20 text-center",
              "data-testid": "hero-section"
            },
            "children": [
              {
                "type": "container",
                "props": {
                  "className": "container mx-auto"
                },
                "children": [
                  {
                    "type": "text",
                    "props": {
                      "level": "h1",
                      "className": "text-5xl font-bold mb-4 text-$titleColor"
                    },
                    "content": "$title"
                  },
                  {
                    "type": "text",
                    "props": {
                      "level": "p",
                      "className": "text-xl mb-8"
                    },
                    "content": "$subtitle"
                  },
                  {
                    "type": "button",
                    "props": {
                      "className": "btn btn-$ctaVariant btn-lg px-8 py-3"
                    },
                    "content": "$ctaText"
                  }
                ]
              }
            ]
          },
          "feature-card": {
            "name": "feature-card",
            "type": "card",
            "props": {
              "className": "feature-card rounded-lg shadow-lg p-6 bg-white"
            },
            "children": [
              {
                "type": "icon",
                "props": {
                  "name": "$icon",
                  "size": 8,
                  "className": "text-$iconColor mb-4"
                }
              },
              {
                "type": "text",
                "props": {
                  "level": "h3",
                  "className": "text-2xl font-semibold mb-2"
                },
                "content": "$title"
              },
              {
                "type": "text",
                "props": {
                  "level": "p",
                  "className": "text-gray-600"
                },
                "content": "$description"
              }
            ]
          },
          "cta-button": {
            "name": "cta-button",
            "type": "button",
            "props": {
              "className": "btn btn-$variant px-6 py-2 rounded-lg transition-all hover:scale-105"
            },
            "content": "$label"
          }
        },
        "expectedDOM": "<section data-testid=\"hero-section\" class=\"hero bg-gradient py-20 text-center\"><div class=\"container mx-auto\"><h1 class=\"text-5xl font-bold mb-4 text-primary\">Welcome to Sovrium</h1><p class=\"text-xl mb-8\">Build powerful applications with configuration</p><button class=\"btn btn-primary btn-lg px-8 py-3\">Get Started</button></div></section><div data-testid=\"block-feature-card-0\" class=\"feature-card rounded-lg shadow-lg p-6 bg-white\"><svg data-testid=\"icon-zap\" width=\"32\" height=\"32\" class=\"text-yellow-500 mb-4\"></svg><h3 class=\"text-2xl font-semibold mb-2\">Fast Development</h3><p class=\"text-gray-600\">Build applications in minutes, not days</p></div><div data-testid=\"block-feature-card-1\" class=\"feature-card rounded-lg shadow-lg p-6 bg-white\"><svg data-testid=\"icon-shield\" width=\"32\" height=\"32\" class=\"text-green-500 mb-4\"></svg><h3 class=\"text-2xl font-semibold mb-2\">Secure by Default</h3><p class=\"text-gray-600\">Enterprise-grade security built-in</p></div><div data-testid=\"block-feature-card-2\" class=\"feature-card rounded-lg shadow-lg p-6 bg-white\"><svg data-testid=\"icon-layers\" width=\"32\" height=\"32\" class=\"text-blue-500 mb-4\"></svg><h3 class=\"text-2xl font-semibold mb-2\">Highly Composable</h3><p class=\"text-gray-600\">Mix and match components effortlessly</p></div><button data-testid=\"block-cta-button-0\" class=\"btn btn-primary px-6 py-2 rounded-lg transition-all hover:scale-105\">Start Building</button><button data-testid=\"block-cta-button-1\" class=\"btn btn-secondary px-6 py-2 rounded-lg transition-all hover:scale-105\">View Documentation</button>",
        "assertions": [
          "Block definition validates with name, type, and template structure (props/children/content)",
          "Block name follows kebab-case pattern: ^[a-z][a-z0-9-]*$",
          "Block type determines HTML element and behavior (section, card, button)",
          "Props support $variable placeholders for dynamic values: className='btn-$variant'",
          "Children support nested component structures with variable substitution",
          "Content property supports simple text with $variable substitution",
          "Page section references block by name with vars object",
          "Variable substitution works across props, children, and content",
          "Multiple block instances render with unique data-testid: block-{name}-{instance}",
          "Hero section renders once with substituted values (title, subtitle, ctaText)",
          "Feature cards render 3 times with different data (icon, title, description per instance)",
          "CTA buttons render 2 times with different variants (primary, secondary)",
          "All nested children render correctly with proper hierarchy",
          "Centralized updates: Changing block definition updates ALL instances automatically",
          "DRY principle: Single block definition reused without code duplication",
          "Complete workflow from block definition to multi-instance rendering works end-to-end"
        ]
      },
      "integrationPoints": [
        "Block name validation: kebab-case pattern ^[a-z][a-z0-9-]*$ enforced",
        "Block type mapping: type property determines HTML element (section, div, button, etc.)",
        "Props schema: References block-props.schema.json for property validation",
        "Children schema: References block-children.schema.json for nested structure",
        "Variable substitution: $variable pattern resolved from vars object at render time",
        "Page sections integration: Blocks referenced via sections[].block with vars",
        "Instance tracking: data-testid='block-{name}' or 'block-{name}-{instance}' for multiple uses",
        "Reusability: Same block template used multiple times with different vars (DRY)",
        "Nested composition: Blocks support deeply nested children structures",
        "Centralized updates: Single block definition change affects all instances globally",
        "Theme integration: Blocks can reference theme tokens via $variable or theme. syntax",
        "Build-time validation: Block structure validated against block.schema.json"
      ]
    }
  ]
}
