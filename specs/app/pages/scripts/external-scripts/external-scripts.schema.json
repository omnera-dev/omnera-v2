{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "external-scripts.schema.json",
  "title": "External Scripts",
  "description": "External JavaScript dependencies",
  "type": "array",
  "items": {
    "type": "object",
    "properties": {
      "src": {
        "type": "string",
        "format": "uri",
        "description": "Script source URL"
      },
      "async": {
        "type": "boolean",
        "default": false,
        "description": "Load script asynchronously"
      },
      "defer": {
        "type": "boolean",
        "default": false,
        "description": "Defer script execution"
      },
      "module": {
        "type": "boolean",
        "default": false,
        "description": "Load as ES module"
      },
      "integrity": {
        "type": "string",
        "description": "Subresource integrity hash"
      },
      "crossorigin": {
        "type": "string",
        "enum": ["anonymous", "use-credentials"],
        "description": "CORS setting"
      },
      "position": {
        "type": "string",
        "enum": ["head", "body-start", "body-end"],
        "default": "body-end",
        "description": "Where to insert the script"
      }
    },
    "required": ["src"],
    "additionalProperties": false
  },
  "examples": [
    [
      {
        "src": "https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js",
        "defer": true,
        "position": "head"
      },
      {
        "src": "https://cdn.jsdelivr.net/npm/chart.js",
        "async": true
      },
      {
        "src": "./js/app.js",
        "module": true,
        "position": "body-end"
      }
    ]
  ],
  "x-specs": [
    {
      "id": "APP-PAGES-EXTERNAL-001",
      "given": "an external script with src URL",
      "when": "src is 'https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js'",
      "then": "it should load external JavaScript from CDN",
      "application": {
        "script": {
          "src": "https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
        },
        "expectedDOM": "<script src=\"https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js\"></script>",
        "useCases": [
          "Alpine.js: Lightweight reactive framework",
          "CDN: Fast delivery via unpkg",
          "Version: 3.x.x (latest minor/patch)"
        ],
        "assertions": [
          "src: HTTPS CDN URL (required)",
          "Loads from unpkg.com CDN",
          "Alpine.js reactive framework",
          "Default: synchronous, body-end"
        ]
      }
    },
    {
      "id": "APP-PAGES-EXTERNAL-002",
      "given": "an external script with async true",
      "when": "async is true",
      "then": "it should load script asynchronously (non-blocking)",
      "application": {
        "script": {
          "src": "https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX",
          "async": true
        },
        "expectedDOM": "<script src=\"https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX\" async></script>",
        "loadingBehavior": {
          "download": "Parallel with HTML parsing (non-blocking)",
          "execution": "Immediately when ready (may interrupt parsing)",
          "order": "Execution order not guaranteed"
        },
        "useCases": [
          "Analytics: Google Analytics, Segment",
          "Ads: Google Ads, Facebook Pixel",
          "Non-critical scripts: Execute ASAP, order doesn't matter"
        ],
        "assertions": [
          "async: true (non-blocking download)",
          "Downloads parallel with HTML parsing",
          "Executes immediately when ready",
          "Best for: analytics, ads, tracking pixels"
        ]
      }
    },
    {
      "id": "APP-PAGES-EXTERNAL-003",
      "given": "an external script with defer true",
      "when": "defer is true",
      "then": "it should defer script execution until DOM loaded",
      "application": {
        "script": {
          "src": "https://unpkg.com/htmx.org@1.9.10",
          "defer": true
        },
        "expectedDOM": "<script src=\"https://unpkg.com/htmx.org@1.9.10\" defer></script>",
        "loadingBehavior": {
          "download": "Parallel with HTML parsing (non-blocking)",
          "execution": "After DOM loaded, before DOMContentLoaded",
          "order": "Execution order guaranteed (document order)"
        },
        "useCases": [
          "Frameworks: htmx, Alpine.js (order matters)",
          "App initialization: Main application script",
          "Dependencies: Scripts that depend on each other"
        ],
        "assertions": [
          "defer: true (non-blocking, ordered)",
          "Downloads parallel with HTML parsing",
          "Executes after DOM ready, in order",
          "Best for: frameworks, app scripts, dependencies"
        ]
      }
    },
    {
      "id": "APP-PAGES-EXTERNAL-004",
      "given": "an external script as ES module",
      "when": "module is true",
      "then": "it should load script with type='module'",
      "application": {
        "script": {
          "src": "./js/app.js",
          "module": true
        },
        "expectedDOM": "<script src=\"./js/app.js\" type=\"module\"></script>",
        "moduleFeatures": {
          "imports": "Can use import/export statements",
          "scope": "Module scope (variables not global)",
          "strict": "Strict mode by default",
          "defer": "Deferred execution automatically"
        },
        "useCases": [
          "Modern apps: ES6+ modules with import/export",
          "Type safety: TypeScript/Flow compiled to ESM",
          "Tree shaking: Bundlers optimize unused imports"
        ],
        "assertions": [
          "module: true → type='module'",
          "Enables import/export syntax",
          "Module scope (not global)",
          "Automatic defer behavior"
        ]
      }
    },
    {
      "id": "APP-PAGES-EXTERNAL-005",
      "given": "an external script with integrity hash",
      "when": "integrity is 'sha384-abc123...'",
      "then": "it should verify subresource integrity for security",
      "application": {
        "script": {
          "src": "https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js",
          "integrity": "sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz",
          "crossorigin": "anonymous"
        },
        "expectedDOM": "<script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\" integrity=\"sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz\" crossorigin=\"anonymous\"></script>",
        "security": {
          "sri": "Subresource Integrity (SRI) prevents CDN tampering",
          "verification": "Browser verifies hash matches downloaded file",
          "protection": "Blocks execution if file modified (attack mitigation)"
        },
        "useCases": [
          "CDN security: Verify Bootstrap, jQuery, React from CDN",
          "Third-party libraries: Prevent supply chain attacks",
          "Compliance: PCI-DSS, SOC 2 require SRI for external scripts"
        ],
        "assertions": [
          "integrity: SHA-384 hash (recommended)",
          "Verifies script not tampered",
          "Requires crossorigin attribute",
          "Security: prevents CDN compromise"
        ]
      }
    },
    {
      "id": "APP-PAGES-EXTERNAL-006",
      "given": "an external script with crossorigin",
      "when": "crossorigin is 'anonymous' or 'use-credentials'",
      "then": "it should set CORS policy for script loading",
      "application": {
        "anonymous": {
          "src": "https://cdn.example.com/lib.js",
          "crossorigin": "anonymous"
        },
        "useCredentials": {
          "src": "https://api.example.com/authenticated-script.js",
          "crossorigin": "use-credentials"
        },
        "expectedDOM": {
          "anonymous": "<script src=\"https://cdn.example.com/lib.js\" crossorigin=\"anonymous\"></script>",
          "useCredentials": "<script src=\"https://api.example.com/authenticated-script.js\" crossorigin=\"use-credentials\"></script>"
        },
        "cors": {
          "anonymous": "No credentials sent (cookies, auth headers omitted)",
          "use-credentials": "Sends credentials (cookies, auth headers included)"
        },
        "useCases": [
          "anonymous: CDN scripts, public libraries (default for SRI)",
          "use-credentials: Authenticated API scripts, user-specific resources"
        ],
        "assertions": [
          "crossorigin: 'anonymous' (no credentials)",
          "crossorigin: 'use-credentials' (with credentials)",
          "Required for SRI verification",
          "CORS: enables cross-origin error reporting"
        ]
      }
    },
    {
      "id": "APP-PAGES-EXTERNAL-007",
      "given": "an external script with position 'head'",
      "when": "position is 'head'",
      "then": "it should insert script in document head",
      "application": {
        "script": {
          "src": "https://cdn.example.com/critical.js",
          "position": "head",
          "defer": true
        },
        "expectedDOM": "<head><script src=\"https://cdn.example.com/critical.js\" defer></script></head>",
        "useCases": [
          "Critical scripts: Must load early (polyfills, feature detection)",
          "Frameworks: Alpine.js, htmx in head with defer",
          "Config scripts: Global config before body content"
        ],
        "assertions": [
          "position: 'head' → <head> tag",
          "Loads early in document",
          "Use with defer to avoid blocking",
          "Best for: critical initialization"
        ]
      }
    },
    {
      "id": "APP-PAGES-EXTERNAL-008",
      "given": "an external script with position 'body-end'",
      "when": "position is 'body-end' (default)",
      "then": "it should insert script at end of body",
      "application": {
        "script": {
          "src": "https://cdn.example.com/app.js",
          "position": "body-end"
        },
        "expectedDOM": "<body><!-- page content --><script src=\"https://cdn.example.com/app.js\"></script></body>",
        "useCases": [
          "App scripts: Main application JavaScript",
          "DOM manipulation: Scripts that need full DOM loaded",
          "Performance: Default position for best performance"
        ],
        "assertions": [
          "position: 'body-end' (default)",
          "Inserted before </body> tag",
          "DOM fully loaded before execution",
          "Best practice: most scripts go here"
        ]
      }
    },
    {
      "id": "APP-PAGES-EXTERNAL-009",
      "given": "an external script with position 'body-start'",
      "when": "position is 'body-start'",
      "then": "it should insert script at start of body",
      "application": {
        "script": {
          "src": "https://cdn.example.com/loader.js",
          "position": "body-start"
        },
        "expectedDOM": "<body><script src=\"https://cdn.example.com/loader.js\"></script><!-- page content --></body>",
        "useCases": [
          "Loading indicators: Show spinner while page loads",
          "Analytics: Track page view before content renders",
          "Error tracking: Catch errors early in page lifecycle"
        ],
        "assertions": [
          "position: 'body-start'",
          "Inserted after <body> tag",
          "Executes before page content loads",
          "Use sparingly: blocks initial render"
        ]
      }
    },
    {
      "id": "APP-PAGES-EXTERNAL-010",
      "given": "external scripts array with multiple libraries",
      "when": "array includes [AlpineJS, Chart.js, app.js]",
      "then": "it should load multiple external scripts in order",
      "application": {
        "scripts": [
          {
            "src": "https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js",
            "defer": true,
            "position": "head"
          },
          {
            "src": "https://cdn.jsdelivr.net/npm/chart.js",
            "async": true,
            "position": "body-end"
          },
          {
            "src": "./js/app.js",
            "module": true,
            "position": "body-end"
          }
        ],
        "expectedDOM": "<head><script src=\"https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js\" defer></script></head><body><!-- content --><script src=\"https://cdn.jsdelivr.net/npm/chart.js\" async></script><script src=\"./js/app.js\" type=\"module\"></script></body>",
        "loadOrder": {
          "head": "Alpine.js (defer, loads with HTML parsing)",
          "bodyEnd": "Chart.js (async, loads parallel) + app.js (module, deferred)"
        },
        "assertions": [
          "Multiple scripts in array",
          "Each with independent config (async, defer, module)",
          "Position controls placement (head vs body)",
          "Execution order: head → body-start → body-end"
        ]
      }
    },
    {
      "id": "APP-PAGES-EXTERNAL-011",
      "given": "external script with relative src",
      "when": "src is './js/app.js' (relative path)",
      "then": "it should load local JavaScript file",
      "application": {
        "script": {
          "src": "./js/app.js",
          "module": true
        },
        "expectedDOM": "<script src=\"./js/app.js\" type=\"module\"></script>",
        "resolution": {
          "relativeTo": "Current page URL",
          "example": "Page: https://example.com/pages/about → Script: https://example.com/pages/js/app.js"
        },
        "useCases": [
          "Local scripts: Bundled application code",
          "Development: Local files during development",
          "Production: CDN or static hosting"
        ],
        "assertions": [
          "src: Relative path (./js/app.js)",
          "Resolved relative to page URL",
          "Local file or same-origin script",
          "module: true for ES modules"
        ]
      }
    },
    {
      "id": "APP-PAGES-EXTERNAL-012",
      "given": "external script with required src only",
      "when": "only src is provided (all other properties optional)",
      "then": "it should load script with default settings (sync, body-end)",
      "application": {
        "script": {
          "src": "https://cdn.example.com/simple.js"
        },
        "expectedDOM": "<body><!-- content --><script src=\"https://cdn.example.com/simple.js\"></script></body>",
        "defaults": {
          "async": false,
          "defer": false,
          "module": false,
          "position": "body-end"
        },
        "behavior": {
          "loading": "Synchronous (blocks HTML parsing)",
          "execution": "Immediate when reached",
          "position": "End of body (after content)"
        },
        "assertions": [
          "src: Only required property",
          "All other properties optional",
          "Defaults: sync, body-end, not module",
          "Simplest script inclusion"
        ]
      }
    },
    {
      "id": "APP-PAGES-SCRIPTS-EXTERNAL-REGRESSION-001",
      "given": "complete application configuration with all features",
      "when": "user completes full workflow",
      "then": "user can complete full External Scripts workflow"
    }
  ]
}
