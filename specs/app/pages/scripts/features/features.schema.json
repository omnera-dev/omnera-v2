{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "features.schema.json",
  "title": "Feature Flags",
  "description": "Client-side feature toggles",
  "type": "object",
  "patternProperties": {
    "^[a-zA-Z][a-zA-Z0-9]*$": {
      "oneOf": [
        {
          "type": "boolean",
          "description": "Simple feature flag"
        },
        {
          "type": "object",
          "description": "Feature configuration",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "config": {
              "type": "object",
              "additionalProperties": true
            }
          }
        }
      ]
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "darkMode": true,
      "animations": {
        "enabled": true,
        "config": {
          "duration": 300,
          "easing": "ease-in-out"
        }
      },
      "cookieConsent": false,
      "liveChat": {
        "enabled": true,
        "config": {
          "provider": "intercom",
          "appId": "abc123"
        }
      }
    }
  ],
  "x-specs": [
    {
      "id": "APP-PAGES-FEATURES-001",
      "given": "a feature with boolean value true",
      "when": "darkMode is true",
      "then": "it should enable simple feature flag",
      "application": {
        "features": {
          "darkMode": true
        },
        "expectedDOM": "<html data-features-dark-mode=\"true\">",
        "behavior": "Dark theme enabled: add 'dark' class to <html>, store in localStorage",
        "useCases": [
          "Theme toggle: Light/dark mode switch",
          "User preference: Persisted in localStorage",
          "CSS: .dark selector for dark theme styles"
        ],
        "assertions": [
          "darkMode: true (boolean)",
          "Simple feature flag (no config)",
          "Applied as data-* attribute",
          "CSS can use: html[data-features-dark-mode='true']"
        ]
      }
    },
    {
      "id": "APP-PAGES-FEATURES-002",
      "given": "a feature with boolean value false",
      "when": "cookieConsent is false",
      "then": "it should disable feature",
      "application": {
        "features": {
          "cookieConsent": false
        },
        "expectedDOM": "<html data-features-cookie-consent=\"false\">",
        "behavior": "Cookie consent disabled: Don't show banner, don't load analytics",
        "useCases": [
          "Privacy: Disable tracking/analytics",
          "GDPR compliance: Respect user preference",
          "Development: Disable consent in dev environment"
        ],
        "assertions": [
          "cookieConsent: false (disabled)",
          "Feature explicitly disabled",
          "Privacy-first: no tracking without consent",
          "False value prevents feature execution"
        ]
      }
    },
    {
      "id": "APP-PAGES-FEATURES-003",
      "given": "a feature with object config",
      "when": "animations has enabled: true and config: { duration: 300, easing: 'ease-in-out' }",
      "then": "it should provide feature with configuration data",
      "application": {
        "features": {
          "animations": {
            "enabled": true,
            "config": {
              "duration": 300,
              "easing": "ease-in-out"
            }
          }
        },
        "expectedDOM": "<html data-features-animations-enabled=\"true\" data-features-animations-config='{\"duration\":300,\"easing\":\"ease-in-out\"}'>",
        "useCases": [
          "Animation settings: Control duration, easing",
          "Performance: Disable animations on low-end devices",
          "Accessibility: Respect prefers-reduced-motion"
        ],
        "assertions": [
          "animations: object with enabled + config",
          "enabled: boolean toggle",
          "config: animation parameters",
          "Config available to CSS/JS"
        ]
      }
    },
    {
      "id": "APP-PAGES-FEATURES-004",
      "given": "a feature config with enabled property",
      "when": "liveChat has enabled: true",
      "then": "it should toggle feature via enabled boolean",
      "application": {
        "features": {
          "liveChat": {
            "enabled": true,
            "config": {
              "provider": "intercom",
              "appId": "abc123"
            }
          }
        },
        "expectedDOM": "<html data-features-live-chat-enabled=\"true\">",
        "behavior": "Load Intercom chat widget with appId 'abc123'",
        "useCases": [
          "Customer support: Intercom, Zendesk, Drift",
          "Environment: Disable in dev, enable in production",
          "User type: Enable for logged-in users only"
        ],
        "assertions": [
          "enabled: true → load live chat",
          "enabled: false → skip chat widget",
          "Config provides provider-specific settings",
          "Conditional loading based on enabled"
        ]
      }
    },
    {
      "id": "APP-PAGES-FEATURES-005",
      "given": "a feature config with nested config object",
      "when": "liveChat.config has provider and appId",
      "then": "it should pass configuration to feature implementation",
      "application": {
        "features": {
          "liveChat": {
            "enabled": true,
            "config": {
              "provider": "intercom",
              "appId": "abc123",
              "alignment": "right",
              "backgroundColor": "#0084FF"
            }
          }
        },
        "code": "if (features.liveChat.enabled) { Intercom('boot', { app_id: features.liveChat.config.appId, alignment: features.liveChat.config.alignment }); }",
        "assertions": [
          "config object passed to implementation",
          "provider: 'intercom', 'zendesk', 'drift'",
          "appId: provider-specific identifier",
          "additionalProperties: flexible config"
        ]
      }
    },
    {
      "id": "APP-PAGES-FEATURES-006",
      "given": "features with camelCase naming",
      "when": "feature names are darkMode, liveChat, cookieConsent",
      "then": "it should validate camelCase naming convention",
      "application": {
        "features": {
          "darkMode": true,
          "liveChat": false,
          "cookieConsent": true,
          "analyticsTracking": false,
          "experimentalFeatures": true
        },
        "namingConvention": "^[a-zA-Z][a-zA-Z0-9]*$ (camelCase, starts with letter)",
        "assertions": [
          "camelCase: darkMode, liveChat, cookieConsent",
          "Pattern: ^[a-zA-Z][a-zA-Z0-9]*$",
          "Valid: myFeature, feature123",
          "Invalid: my-feature, _feature, 123feature"
        ]
      }
    },
    {
      "id": "APP-PAGES-FEATURES-007",
      "given": "features with oneOf type (boolean or object)",
      "when": "feature can be true or { enabled: true, config: {...} }",
      "then": "it should support both simple and complex feature definitions",
      "application": {
        "features": {
          "simpleFeature": true,
          "complexFeature": {
            "enabled": true,
            "config": {
              "option1": "value1",
              "option2": 42
            }
          }
        },
        "oneOfTypes": {
          "boolean": "Simple toggle (true/false)",
          "object": "Complex with enabled + config"
        },
        "assertions": [
          "oneOf: boolean OR object",
          "Simple: feature = true",
          "Complex: feature = { enabled, config }",
          "Flexibility: choose based on need"
        ]
      }
    },
    {
      "id": "APP-PAGES-FEATURES-008",
      "given": "feature config with additionalProperties true",
      "when": "config accepts any custom properties",
      "then": "it should support flexible feature configuration",
      "application": {
        "features": {
          "notifications": {
            "enabled": true,
            "config": {
              "provider": "onesignal",
              "appId": "xyz789",
              "autoPrompt": false,
              "position": "bottom-right",
              "customIcon": "https://example.com/icon.png"
            }
          }
        },
        "assertions": [
          "config.additionalProperties: true",
          "Accepts any custom properties",
          "Provider-specific: each provider has unique config",
          "Flexible: adapt to any feature needs"
        ]
      }
    },
    {
      "id": "APP-PAGES-FEATURES-009",
      "given": "common feature flags (darkMode, animations, cookieConsent, liveChat)",
      "when": "features control client-side behavior",
      "then": "it should enable/disable UI features dynamically",
      "application": {
        "features": {
          "darkMode": true,
          "animations": {
            "enabled": true,
            "config": {
              "duration": 300
            }
          },
          "cookieConsent": false,
          "liveChat": {
            "enabled": true,
            "config": {
              "provider": "intercom"
            }
          }
        },
        "behavior": {
          "darkMode": "Add 'dark' class to <html>",
          "animations": "Set CSS animation duration to 300ms",
          "cookieConsent": "Don't show banner, disable analytics",
          "liveChat": "Load Intercom widget"
        },
        "assertions": [
          "Feature flags control client behavior",
          "Dark mode, animations, privacy, support",
          "Dynamic: enable/disable without code changes",
          "Runtime: check flags in JS"
        ]
      }
    },
    {
      "id": "APP-PAGES-FEATURES-010",
      "given": "features accessible in client JavaScript",
      "when": "features are injected into page",
      "then": "it should provide runtime feature detection",
      "application": {
        "features": {
          "newDashboard": true,
          "betaFeatures": false
        },
        "injection": {
          "method": "window.FEATURES or data-* attributes",
          "access": "window.FEATURES.newDashboard or document.documentElement.dataset.featuresNewDashboard"
        },
        "code": "if (window.FEATURES.newDashboard) { loadNewDashboard(); } else { loadOldDashboard(); }",
        "useCases": [
          "A/B testing: newDashboard vs old",
          "Beta features: betaFeatures flag",
          "Gradual rollout: enable features incrementally"
        ],
        "assertions": [
          "Features available at runtime",
          "window.FEATURES global object",
          "Runtime detection: check before execution",
          "Pattern: feature flags for gradual rollout"
        ]
      }
    },
    {
      "id": "APP-PAGES-SCRIPTS-FEATURES-REGRESSION-001",
      "given": "complete application configuration with all features",
      "when": "user completes full workflow",
      "then": "user can complete full Feature Flags workflow"
    }
  ]
}
