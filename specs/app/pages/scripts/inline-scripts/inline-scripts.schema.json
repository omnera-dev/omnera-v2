{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "inline-scripts.schema.json",
  "title": "Inline Scripts",
  "description": "Inline JavaScript code snippets",
  "type": "array",
  "items": {
    "type": "object",
    "properties": {
      "code": {
        "type": "string",
        "description": "JavaScript code to execute"
      },
      "position": {
        "type": "string",
        "enum": ["head", "body-start", "body-end"],
        "default": "body-end",
        "description": "Where to insert the script"
      },
      "async": {
        "type": "boolean",
        "default": false,
        "description": "Wrap in async IIFE"
      }
    },
    "required": ["code"],
    "additionalProperties": false
  },
  "examples": [
    [
      {
        "code": "console.log('Page loaded');",
        "position": "body-end"
      },
      {
        "code": "window.config = { apiUrl: 'https://api.example.com' };",
        "position": "head"
      }
    ]
  ],
  "x-specs": [
    {
      "id": "APP-PAGES-INLINE-001",
      "given": "an inline script with code",
      "when": "code is 'console.log('Page loaded');'",
      "then": "it should inject inline JavaScript code",
      "application": {
        "script": {
          "code": "console.log('Page loaded');"
        },
        "expectedDOM": "<script>console.log('Page loaded');</script>",
        "useCases": [
          "Logging: Debug messages, page lifecycle tracking",
          "Initialization: Simple setup code",
          "Event handlers: Inline event listeners"
        ],
        "assertions": [
          "code: JavaScript string (required)",
          "Inline script (no src attribute)",
          "Executes immediately in-place",
          "Default: body-end position"
        ]
      }
    },
    {
      "id": "APP-PAGES-INLINE-002",
      "given": "an inline script with position 'body-end'",
      "when": "position is 'body-end' (default)",
      "then": "it should insert code at end of body",
      "application": {
        "script": {
          "code": "document.querySelector('#app').classList.add('loaded');",
          "position": "body-end"
        },
        "expectedDOM": "<body><!-- content --><script>document.querySelector('#app').classList.add('loaded');</script></body>",
        "useCases": [
          "DOM manipulation: After all content loaded",
          "Analytics: Track full page render",
          "UI updates: Add classes after DOM ready"
        ],
        "assertions": [
          "position: 'body-end' (default)",
          "Inserted before </body> tag",
          "DOM fully available",
          "Best practice for inline scripts"
        ]
      }
    },
    {
      "id": "APP-PAGES-INLINE-003",
      "given": "an inline script with position 'head'",
      "when": "position is 'head'",
      "then": "it should insert code in document head",
      "application": {
        "script": {
          "code": "window.APP_CONFIG = { apiUrl: 'https://api.example.com', debug: false };",
          "position": "head"
        },
        "expectedDOM": "<head><script>window.APP_CONFIG = { apiUrl: 'https://api.example.com', debug: false };</script></head>",
        "useCases": [
          "Global config: Available before body loads",
          "Critical setup: Must execute early",
          "Feature detection: Browser capability checks"
        ],
        "assertions": [
          "position: 'head'",
          "Executes before body content",
          "Use for: global config, critical init",
          "Available to all subsequent scripts"
        ]
      }
    },
    {
      "id": "APP-PAGES-INLINE-004",
      "given": "an inline script with position 'body-start'",
      "when": "position is 'body-start'",
      "then": "it should insert code at start of body",
      "application": {
        "script": {
          "code": "document.body.innerHTML = '<div class=\"loader\">Loading...</div>' + document.body.innerHTML;",
          "position": "body-start"
        },
        "expectedDOM": "<body><script>document.body.innerHTML = '<div class=\"loader\">Loading...</div>' + document.body.innerHTML;</script><!-- content --></body>",
        "useCases": [
          "Loading indicators: Show spinner before content",
          "Critical UI: Must appear immediately",
          "Early tracking: Analytics before content"
        ],
        "assertions": [
          "position: 'body-start'",
          "Executes before page content",
          "Use sparingly: blocks initial render",
          "Best for: loading indicators"
        ]
      }
    },
    {
      "id": "APP-PAGES-INLINE-005",
      "given": "an inline script with async true",
      "when": "async is true",
      "then": "it should wrap code in async IIFE (async function)",
      "application": {
        "script": {
          "code": "const data = await fetch('/api/data').then(r => r.json()); console.log(data);",
          "async": true
        },
        "expectedDOM": "<script>(async () => { const data = await fetch('/api/data').then(r => r.json()); console.log(data); })();</script>",
        "useCases": [
          "API calls: Fetch data with await",
          "Async operations: Database queries, file reads",
          "Top-level await: Use await in script body"
        ],
        "assertions": [
          "async: true → wrap in async IIFE",
          "Enables await keyword in code",
          "Pattern: (async () => { code })();",
          "Use for: async/await in inline scripts"
        ]
      }
    },
    {
      "id": "APP-PAGES-INLINE-006",
      "given": "an inline script setting window config",
      "when": "code is 'window.config = { apiUrl: '...' };'",
      "then": "it should inject global configuration",
      "application": {
        "script": {
          "code": "window.APP_CONFIG = { apiUrl: 'https://api.example.com', version: '1.0.0', features: { darkMode: true } };"
        },
        "expectedDOM": "<script>window.APP_CONFIG = { apiUrl: 'https://api.example.com', version: '1.0.0', features: { darkMode: true } };</script>",
        "useCases": [
          "App config: API URLs, feature flags",
          "Environment: Production vs development settings",
          "Globals: Make config available to all scripts"
        ],
        "assertions": [
          "Sets window.APP_CONFIG global",
          "Available to all subsequent scripts",
          "Common pattern: config in head",
          "Use for: application configuration"
        ]
      }
    },
    {
      "id": "APP-PAGES-INLINE-007",
      "given": "inline scripts array with multiple snippets",
      "when": "array contains [console.log, window.config]",
      "then": "it should inject multiple inline scripts in order",
      "application": {
        "scripts": [
          {
            "code": "console.log('Script 1: Initializing...');"
          },
          {
            "code": "window.APP_CONFIG = { ready: false };"
          },
          {
            "code": "console.log('Script 2: Config set'); window.APP_CONFIG.ready = true;"
          }
        ],
        "expectedDOM": "<body><script>console.log('Script 1: Initializing...');</script><script>window.APP_CONFIG = { ready: false };</script><script>console.log('Script 2: Config set'); window.APP_CONFIG.ready = true;</script></body>",
        "executionOrder": "Script 1 → Script 2 → Script 3 (synchronous, sequential)",
        "assertions": [
          "Multiple inline scripts in array",
          "Each script executes in order",
          "Subsequent scripts see previous results",
          "Pattern: sequential initialization steps"
        ]
      }
    },
    {
      "id": "APP-PAGES-INLINE-008",
      "given": "an inline script with required code only",
      "when": "only code is provided (position and async optional)",
      "then": "it should inject code with default settings (body-end, sync)",
      "application": {
        "script": {
          "code": "alert('Hello, World!');"
        },
        "expectedDOM": "<body><!-- content --><script>alert('Hello, World!');</script></body>",
        "defaults": {
          "position": "body-end",
          "async": false
        },
        "assertions": [
          "code: Only required property",
          "Default position: body-end",
          "Default async: false (synchronous)",
          "Simplest inline script"
        ]
      }
    },
    {
      "id": "APP-PAGES-INLINE-009",
      "given": "inline scripts for analytics tracking",
      "when": "code includes analytics initialization",
      "then": "it should enable custom tracking code",
      "application": {
        "script": {
          "code": "window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-XXXXXXXXXX');",
          "position": "head"
        },
        "expectedDOM": "<head><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-XXXXXXXXXX');</script></head>",
        "useCases": [
          "Google Analytics: gtag initialization",
          "Custom tracking: Event tracking setup",
          "Tag Manager: Data layer setup"
        ],
        "assertions": [
          "Analytics: Google Analytics gtag",
          "position: head (before body)",
          "Initialize data layer early",
          "Common pattern: analytics in head"
        ]
      }
    },
    {
      "id": "APP-PAGES-INLINE-010",
      "given": "inline scripts execution order",
      "when": "scripts have different positions (head, body-start, body-end)",
      "then": "it should execute scripts in document order",
      "application": {
        "scripts": [
          {
            "code": "window.step = 1;",
            "position": "head"
          },
          {
            "code": "window.step = 2;",
            "position": "body-start"
          },
          {
            "code": "window.step = 3;",
            "position": "body-end"
          }
        ],
        "expectedDOM": "<head><script>window.step = 1;</script></head><body><script>window.step = 2;</script><!-- content --><script>window.step = 3;</script></body>",
        "executionOrder": {
          "1": "head script (before body)",
          "2": "body-start script (after <body> tag)",
          "3": "body-end script (before </body> tag)"
        },
        "assertions": [
          "Execution order: head → body-start → body-end",
          "Scripts execute in document order",
          "Position controls placement and timing",
          "window.step = 3 (final value)"
        ]
      }
    },
    {
      "id": "APP-PAGES-SCRIPTS-INLINE-REGRESSION-001",
      "given": "complete application configuration with all features",
      "when": "user completes full workflow",
      "then": "user can complete full Inline Scripts workflow"
    }
  ]
}
