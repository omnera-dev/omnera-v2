{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "dns-prefetch.schema.json",
  "title": "DNS Prefetch",
  "description": "DNS prefetch hints for external domains",
  "type": "array",
  "items": {
    "type": "string",
    "format": "uri",
    "pattern": "^https?://",
    "description": "Domain to prefetch DNS for"
  },
  "uniqueItems": true,
  "examples": [
    ["https://fonts.googleapis.com", "https://www.google-analytics.com", "https://cdn.example.com"]
  ],
  "x-specs": [
    {
      "id": "APP-PAGES-DNS-001",
      "given": "DNS prefetch array with domains",
      "when": "array contains external domain URLs",
      "then": "it should prefetch DNS for listed domains",
      "application": {
        "dnsPrefetch": ["https://fonts.googleapis.com", "https://www.google-analytics.com", "https://cdn.example.com"],
        "expectedHTML": "<link rel=\"dns-prefetch\" href=\"https://fonts.googleapis.com\" /><link rel=\"dns-prefetch\" href=\"https://www.google-analytics.com\" /><link rel=\"dns-prefetch\" href=\"https://cdn.example.com\" />",
        "assertions": ["Array of domain URLs", "Pattern: ^https?://", "Prefetches DNS before actual requests"]
      }
    },
    {
      "id": "APP-PAGES-DNS-002",
      "given": "DNS prefetch for font domains",
      "when": "array includes 'https://fonts.googleapis.com' and 'https://fonts.gstatic.com'",
      "then": "it should optimize Google Fonts loading",
      "application": {
        "dnsPrefetch": ["https://fonts.googleapis.com", "https://fonts.gstatic.com"],
        "expectedHTML": "<link rel=\"dns-prefetch\" href=\"https://fonts.googleapis.com\" /><link rel=\"dns-prefetch\" href=\"https://fonts.gstatic.com\" />",
        "benefit": "Reduces font loading latency by ~100-200ms",
        "assertions": ["Google Fonts: Two domains (googleapis.com + gstatic.com)", "Common use case", "Saves DNS lookup time"]
      }
    },
    {
      "id": "APP-PAGES-DNS-003",
      "given": "DNS prefetch for analytics domains",
      "when": "array includes 'https://www.google-analytics.com' or 'https://plausible.io'",
      "then": "it should optimize analytics script loading",
      "application": {
        "dnsPrefetch": ["https://www.google-analytics.com", "https://plausible.io"],
        "expectedHTML": "<link rel=\"dns-prefetch\" href=\"https://www.google-analytics.com\" /><link rel=\"dns-prefetch\" href=\"https://plausible.io\" />",
        "assertions": ["Analytics: GA, Plausible, Matomo, etc.", "Non-blocking optimization", "Faster tracking script load"]
      }
    },
    {
      "id": "APP-PAGES-DNS-004",
      "given": "DNS prefetch for CDN domains",
      "when": "array includes 'https://unpkg.com' or 'https://cdn.jsdelivr.net'",
      "then": "it should optimize CDN resource loading",
      "application": {
        "dnsPrefetch": ["https://unpkg.com", "https://cdn.jsdelivr.net", "https://cdnjs.cloudflare.com"],
        "expectedHTML": "<link rel=\"dns-prefetch\" href=\"https://unpkg.com\" /><link rel=\"dns-prefetch\" href=\"https://cdn.jsdelivr.net\" /><link rel=\"dns-prefetch\" href=\"https://cdnjs.cloudflare.com\" />",
        "assertions": ["CDN domains: unpkg, jsDelivr, cdnjs", "Optimizes library/asset loading", "Common for: JS libraries, fonts, icons"]
      }
    },
    {
      "id": "APP-PAGES-DNS-005",
      "given": "DNS prefetch for API domains",
      "when": "array includes API endpoint domains",
      "then": "it should optimize API request latency",
      "application": {
        "dnsPrefetch": ["https://api.example.com", "https://graphql.example.com"],
        "expectedHTML": "<link rel=\"dns-prefetch\" href=\"https://api.example.com\" /><link rel=\"dns-prefetch\" href=\"https://graphql.example.com\" />",
        "benefit": "First API call is faster (DNS already resolved)",
        "assertions": ["API domains: REST, GraphQL endpoints", "Reduces first request latency", "Use for: SPA data fetching"]
      }
    },
    {
      "id": "APP-PAGES-DNS-006",
      "given": "DNS prefetch with http/https protocol",
      "when": "URLs start with https:// or http://",
      "then": "it should validate protocol in URL pattern",
      "application": {
        "valid": ["https://example.com", "http://legacy.example.com"],
        "invalid": ["//example.com", "example.com", "ftp://files.example.com"],
        "pattern": "^https?://",
        "assertions": ["Must start with http:// or https://", "Protocol required for DNS prefetch", "Most use https://"]
      }
    },
    {
      "id": "APP-PAGES-DNS-007",
      "given": "DNS prefetch with unique items",
      "when": "array has uniqueItems constraint",
      "then": "it should prevent duplicate domain entries",
      "application": {
        "valid": ["https://fonts.googleapis.com", "https://www.google-analytics.com"],
        "invalid": ["https://fonts.googleapis.com", "https://fonts.googleapis.com"],
        "uniqueItems": true,
        "assertions": ["uniqueItems: true", "No duplicate domains", "Validation prevents waste"]
      }
    },
    {
      "id": "APP-PAGES-DNS-008",
      "given": "DNS prefetch for multiple third-party services",
      "when": "array contains [fonts, analytics, CDN, social] domains",
      "then": "it should optimize multiple external connections",
      "application": {
        "dnsPrefetch": ["https://fonts.googleapis.com", "https://www.google-analytics.com", "https://cdn.jsdelivr.net", "https://connect.facebook.net"],
        "categories": {"fonts": "fonts.googleapis.com", "analytics": "google-analytics.com", "CDN": "cdn.jsdelivr.net", "social": "connect.facebook.net"},
        "assertions": ["Multiple categories: fonts + analytics + CDN + social", "Optimizes all third-party connections", "Common production setup"]
      }
    },
    {
      "id": "APP-PAGES-DNS-009",
      "given": "DNS prefetch before resource fetch",
      "when": "DNS resolution happens early in page load",
      "then": "it should reduce connection latency",
      "application": {
        "timeline": {"1. Page loads": "DNS prefetch hints in <head>", "2. Browser": "Resolves DNS in background", "3. Later": "Script/asset requests use cached DNS", "Result": "Faster connection (~100-200ms saved per domain)"},
        "assertions": ["Early DNS resolution", "Background process (non-blocking)", "Cached for later requests", "Reduces latency"]
      }
    },
    {
      "id": "APP-PAGES-DNS-010",
      "given": "DNS prefetch performance benefit",
      "when": "domains are resolved before actual requests",
      "then": "it should improve perceived page load speed",
      "application": {
        "metrics": {"DNS lookup time": "~20-120ms per domain (varies by location)", "Saved per domain": "~100ms average", "Multiple domains": "Cumulative benefit (3 domains = ~300ms saved)"},
        "perceptionBenefit": "Faster interactive time, improved Core Web Vitals (LCP, FID)",
        "assertions": ["Performance optimization", "Improves Core Web Vitals", "Best practice for third-party domains", "Non-blocking (no downside)"]
      }
    },
    {
      "id": "APP-PAGES-META-PERFORMANCE-DNS-PREFETCH-REGRESSION-001",
      "given": "complete application configuration with all features",
      "when": "user completes full workflow",
      "then": "user can complete full DNS prefetch workflow"
    }
  ]
}
